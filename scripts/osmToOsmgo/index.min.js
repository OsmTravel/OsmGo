"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t,e){return t(e={exports:{}},e.exports),e.exports}var r=e((function(t,e){const r=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",n="["+r+"][:A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*",o=new RegExp("^"+n+"$");e.isExist=function(t){return void 0!==t},e.isEmptyObject=function(t){return 0===Object.keys(t).length},e.merge=function(t,e,r){if(e){const n=Object.keys(e),o=n.length;for(let i=0;i<o;i++)t[n[i]]="strict"===r?[e[n[i]]]:e[n[i]]}},e.getValue=function(t){return e.isExist(t)?t:""},e.buildOptions=function(t,e,r){var n={};if(!t)return e;for(let o=0;o<r.length;o++)void 0!==t[r[o]]?n[r[o]]=t[r[o]]:n[r[o]]=e[r[o]];return n},e.isTagNameInArrayMode=function(t,e,r){return!1!==e&&(e instanceof RegExp?e.test(t):"function"==typeof e?!!e(t,r):"strict"===e)},e.isName=function(t){const e=o.exec(t);return!(null==e)},e.getAllMatches=function(t,e){const r=[];let n=e.exec(t);for(;n;){const o=[],i=n.length;for(let t=0;t<i;t++)o.push(n[t]);r.push(o),n=e.exec(t)}return r},e.nameRegexp=n}));r.isExist,r.isEmptyObject,r.merge,r.getValue,r.buildOptions,r.isTagNameInArrayMode,r.isName,r.getAllMatches,r.nameRegexp;const n=function(t,e,o){const i={};if((!t.child||r.isEmptyObject(t.child))&&(!t.attrsMap||r.isEmptyObject(t.attrsMap)))return r.isExist(t.val)?t.val:"";if(r.isExist(t.val)&&("string"!=typeof t.val||""!==t.val&&t.val!==e.cdataPositionChar)){const n=r.isTagNameInArrayMode(t.tagname,e.arrayMode,o);i[e.textNodeName]=n?[t.val]:t.val}r.merge(i,t.attrsMap,e.arrayMode);const a=Object.keys(t.child);for(let s=0;s<a.length;s++){const u=a[s];if(t.child[u]&&t.child[u].length>1){i[u]=[];for(let r in t.child[u])t.child[u].hasOwnProperty(r)&&i[u].push(n(t.child[u][r],e,u))}else{const a=n(t.child[u][0],e,u),s=!0===e.arrayMode&&"object"==typeof a||r.isTagNameInArrayMode(u,e.arrayMode,o);i[u]=s?[a]:a}}return i};var o={convertToJson:n},i=function(t,e,r){this.tagname=t,this.parent=e,this.child={},this.attrsMap={},this.val=r,this.addChild=function(t){Array.isArray(this.child[t.tagname])?this.child[t.tagname].push(t):this.child[t.tagname]=[t]}};const a=r.buildOptions;"<((!\\[CDATA\\[([\\s\\S]*?)(]]>))|((NAME:)?(NAME))([^>]*)>|((\\/)(NAME)\\s*>))([^<]*)".replace(/NAME/g,r.nameRegexp),!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const s={attributeNamePrefix:"@_",attrNodeName:!1,textNodeName:"#text",ignoreAttributes:!0,ignoreNameSpace:!1,allowBooleanAttributes:!1,parseNodeValue:!0,parseAttributeValue:!1,arrayMode:!1,trimValues:!0,cdataTagName:!1,cdataPositionChar:"\\c",tagValueProcessor:function(t,e){return t},attrValueProcessor:function(t,e){return t},stopNodes:[]};var u=s;const l=["attributeNamePrefix","attrNodeName","textNodeName","ignoreAttributes","ignoreNameSpace","allowBooleanAttributes","parseNodeValue","parseAttributeValue","arrayMode","trimValues","cdataTagName","cdataPositionChar","tagValueProcessor","attrValueProcessor","parseTrueNumberOnly","stopNodes"];var c=l;function f(t,e,r){return e&&(r.trimValues&&(e=e.trim()),e=h(e=r.tagValueProcessor(e,t),r.parseNodeValue,r.parseTrueNumberOnly)),e}function p(t,e){if(e.ignoreNameSpace){const e=t.split(":"),r="/"===t.charAt(0)?"/":"";if("xmlns"===e[0])return"";2===e.length&&(t=r+e[1])}return t}function h(t,e,n){if(e&&"string"==typeof t){let e;return""===t.trim()||isNaN(t)?e="true"===t||"false"!==t&&t:(-1!==t.indexOf("0x")?e=Number.parseInt(t,16):-1!==t.indexOf(".")?(e=Number.parseFloat(t),t=t.replace(/\.?0+$/,"")):e=Number.parseInt(t,10),n&&(e=String(e)===t?e:t)),e}return r.isExist(t)?t:""}const g=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])(.*?)\\3)?","g");function d(t,e){if(!e.ignoreAttributes&&"string"==typeof t){t=t.replace(/\r?\n/g," ");const n=r.getAllMatches(t,g),o=n.length,i={};for(let t=0;t<o;t++){const r=p(n[t][1],e);r.length&&(void 0!==n[t][4]?(e.trimValues&&(n[t][4]=n[t][4].trim()),n[t][4]=e.attrValueProcessor(n[t][4],r),i[e.attributeNamePrefix+r]=h(n[t][4],e.parseAttributeValue,e.parseTrueNumberOnly)):e.allowBooleanAttributes&&(i[e.attributeNamePrefix+r]=!0))}if(!Object.keys(i).length)return;if(e.attrNodeName){const t={};return t[e.attrNodeName]=i,t}return i}}function y(t,e){let r,n="";for(let o=e;o<t.length;o++){let e=t[o];if(r)e===r&&(r="");else if('"'===e||"'"===e)r=e;else{if(">"===e)return{data:n,index:o};"\t"===e&&(e=" ")}n+=e}}function b(t,e,r,n){const o=t.indexOf(e,r);if(-1===o)throw new Error(n);return o+e.length-1}var m={defaultOptions:u,props:c,getTraversalObj:function(t,e){t=t.replace(/\r\n?/g,"\n"),e=a(e,s,l);const n=new i("!xml");let o=n,u="";for(let n=0;n<t.length;n++){if("<"===t[n])if("/"===t[n+1]){const i=b(t,">",n,"Closing Tag is not closed.");let a=t.substring(n+2,i).trim();if(e.ignoreNameSpace){const t=a.indexOf(":");-1!==t&&(a=a.substr(t+1))}o&&(o.val?o.val=r.getValue(o.val)+""+f(a,u,e):o.val=f(a,u,e)),e.stopNodes.length&&e.stopNodes.includes(o.tagname)&&(o.child=[],null==o.attrsMap&&(o.attrsMap={}),o.val=t.substr(o.startIndex+1,n-o.startIndex-1)),o=o.parent,u="",n=i}else if("?"===t[n+1])n=b(t,"?>",n,"Pi Tag is not closed.");else if("!--"===t.substr(n+1,3))n=b(t,"--\x3e",n,"Comment is not closed.");else if("!D"===t.substr(n+1,2)){const e=b(t,">",n,"DOCTYPE is not closed.");n=t.substring(n,e).indexOf("[")>=0?t.indexOf("]>",n)+1:e}else if("!["===t.substr(n+1,2)){const a=b(t,"]]>",n,"CDATA is not closed.")-2,s=t.substring(n+9,a);if(u&&(o.val=r.getValue(o.val)+""+f(o.tagname,u,e),u=""),e.cdataTagName){const t=new i(e.cdataTagName,o,s);o.addChild(t),o.val=r.getValue(o.val)+e.cdataPositionChar,s&&(t.val=s)}else o.val=(o.val||"")+(s||"");n=a+2}else{const a=y(t,n+1);let s=a.data;const l=a.index,c=s.indexOf(" ");let p=s,h=!0;if(-1!==c&&(p=s.substr(0,c).replace(/\s\s*$/,""),s=s.substr(c+1)),e.ignoreNameSpace){const t=p.indexOf(":");-1!==t&&(p=p.substr(t+1),h=p!==a.data.substr(t+1))}if(o&&u&&"!xml"!==o.tagname&&(o.val=r.getValue(o.val)+""+f(o.tagname,u,e)),s.length>0&&s.lastIndexOf("/")===s.length-1){"/"===p[p.length-1]?(p=p.substr(0,p.length-1),s=p):s=s.substr(0,s.length-1);const t=new i(p,o,"");p!==s&&(t.attrsMap=d(s,e)),o.addChild(t)}else{const t=new i(p,o);e.stopNodes.length&&e.stopNodes.includes(t.tagname)&&(t.startIndex=l),p!==s&&h&&(t.attrsMap=d(s,e)),o.addChild(t),o=t}u="",n=l}else u+=t[n]}return n}};const v={allowBooleanAttributes:!1},w=["allowBooleanAttributes"];function j(t,e){for(var r=e;e<t.length;e++)if("?"!=t[e]&&" "!=t[e]);else{var n=t.substr(r,e-r);if(e>5&&"xml"===n)return N("InvalidXml","XML declaration allowed only at the start of the document.",C(t,e));if("?"==t[e]&&">"==t[e+1]){e++;break}}return e}function A(t,e){if(t.length>e+5&&"-"===t[e+1]&&"-"===t[e+2]){for(e+=3;e<t.length;e++)if("-"===t[e]&&"-"===t[e+1]&&">"===t[e+2]){e+=2;break}}else if(t.length>e+8&&"D"===t[e+1]&&"O"===t[e+2]&&"C"===t[e+3]&&"T"===t[e+4]&&"Y"===t[e+5]&&"P"===t[e+6]&&"E"===t[e+7]){let r=1;for(e+=8;e<t.length;e++)if("<"===t[e])r++;else if(">"===t[e]&&(r--,0===r))break}else if(t.length>e+9&&"["===t[e+1]&&"C"===t[e+2]&&"D"===t[e+3]&&"A"===t[e+4]&&"T"===t[e+5]&&"A"===t[e+6]&&"["===t[e+7])for(e+=8;e<t.length;e++)if("]"===t[e]&&"]"===t[e+1]&&">"===t[e+2]){e+=2;break}return e}function E(t,e){let r="",n="",o=!1;for(;e<t.length;e++){if('"'===t[e]||"'"===t[e])if(""===n)n=t[e];else{if(n!==t[e])continue;n=""}else if(">"===t[e]&&""===n){o=!0;break}r+=t[e]}return""===n&&{value:r,index:e,tagClosed:o}}const x=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function _(t,e){const n=r.getAllMatches(t,x),o={};for(let r=0;r<n.length;r++){if(0===n[r][1].length)return N("InvalidAttr","Attribute '"+n[r][2]+"' has no space in starting.",S(t,n[r][0]));if(void 0===n[r][3]&&!e.allowBooleanAttributes)return N("InvalidAttr","boolean attribute '"+n[r][2]+"' is not allowed.",S(t,n[r][0]));const i=n[r][2];if(!P(i))return N("InvalidAttr","Attribute '"+i+"' is an invalid name.",S(t,n[r][0]));if(o.hasOwnProperty(i))return N("InvalidAttr","Attribute '"+i+"' is repeated.",S(t,n[r][0]));o[i]=1}return!0}function O(t,e){if(";"===t[++e])return-1;if("#"===t[e])return function(t,e){let r=/\d/;for("x"===t[e]&&(e++,r=/[\da-fA-F]/);e<t.length;e++){if(";"===t[e])return e;if(!t[e].match(r))break}return-1}(t,++e);let r=0;for(;e<t.length;e++,r++)if(!(t[e].match(/\w/)&&r<20)){if(";"===t[e])break;return-1}return e}function N(t,e,r){return{err:{code:t,msg:e,line:r}}}function P(t){return r.isName(t)}function C(t,e){return t.substring(0,e).split(/\r?\n/).length}function S(t,e){return t.indexOf(e)+e.length}var k=function(t,e){e=r.buildOptions(e,v,w);const n=[];let o=!1,i=!1;"\ufeff"===t[0]&&(t=t.substr(1));for(let s=0;s<t.length;s++)if("<"===t[s]&&"?"===t[s+1]){if(s+=2,s=j(t,s),s.err)return s}else{if("<"!==t[s]){if(" "===t[s]||"\t"===t[s]||"\n"===t[s]||"\r"===t[s])continue;return N("InvalidChar","char '"+t[s]+"' is not expected.",C(t,s))}if(s++,"!"===t[s]){s=A(t,s);continue}{let u=!1;"/"===t[s]&&(u=!0,s++);let l="";for(;s<t.length&&">"!==t[s]&&" "!==t[s]&&"\t"!==t[s]&&"\n"!==t[s]&&"\r"!==t[s];s++)l+=t[s];if(l=l.trim(),"/"===l[l.length-1]&&(l=l.substring(0,l.length-1),s--),a=l,!r.isName(a)){let e;return e=0===l.trim().length?"There is an unnecessary space between tag name and backward slash '</ ..'.":"Tag '"+l+"' is an invalid name.",N("InvalidTag",e,C(t,s))}const c=E(t,s);if(!1===c)return N("InvalidAttr","Attributes for '"+l+"' have open quote.",C(t,s));let f=c.value;if(s=c.index,"/"===f[f.length-1]){f=f.substring(0,f.length-1);const r=_(f,e);if(!0!==r)return N(r.err.code,r.err.msg,C(t,s-f.length+r.err.line));o=!0}else if(u){if(!c.tagClosed)return N("InvalidTag","Closing tag '"+l+"' doesn't have proper closing.",C(t,s));if(f.trim().length>0)return N("InvalidTag","Closing tag '"+l+"' can't have attributes or invalid starting.",C(t,s));{const e=n.pop();if(l!==e)return N("InvalidTag","Closing tag '"+e+"' is expected inplace of '"+l+"'.",C(t,s));0==n.length&&(i=!0)}}else{const r=_(f,e);if(!0!==r)return N(r.err.code,r.err.msg,C(t,s-f.length+r.err.line));if(!0===i)return N("InvalidXml","Multiple possible root nodes found.",C(t,s));n.push(l),o=!0}for(s++;s<t.length;s++)if("<"===t[s]){if("!"===t[s+1]){s++,s=A(t,s);continue}if("?"!==t[s+1])break;if(s=j(t,++s),s.err)return s}else if("&"===t[s]){const e=O(t,s);if(-1==e)return N("InvalidChar","char '&' is not expected.",C(t,s));s=e}"<"===t[s]&&s--}}var a;return o?!(n.length>0)||N("InvalidXml","Invalid '"+JSON.stringify(n,null,4).replace(/\r?\n/g,"")+"' found.",1):N("InvalidXml","Start tag expected.",1)};const F=function(t){return String.fromCharCode(t)},T={nilChar:F(176),missingChar:F(201),nilPremitive:F(175),missingPremitive:F(200),emptyChar:F(178),emptyValue:F(177),boundryChar:F(179),objStart:F(198),arrStart:F(204),arrayEnd:F(185)},M=[T.nilChar,T.nilPremitive,T.missingChar,T.missingPremitive,T.boundryChar,T.emptyChar,T.emptyValue,T.arrayEnd,T.objStart,T.arrStart],I=function(t,e,r){if("string"==typeof e)return t&&t[0]&&void 0!==t[0].val?V(t[0].val):V(t);{const o=void 0===(n=t)?T.missingChar:null===n?T.nilChar:!(n.child&&0===Object.keys(n.child).length&&(!n.attrsMap||0===Object.keys(n.attrsMap).length))||T.emptyChar;if(!0===o){let n="";if(Array.isArray(e)){n+=T.arrStart;const o=e[0],i=t.length;if("string"==typeof o)for(let e=0;e<i;e++){const r=V(t[e].val);n=D(n,r)}else for(let e=0;e<i;e++){const i=I(t[e],o,r);n=D(n,i)}n+=T.arrayEnd}else{n+=T.objStart;const o=Object.keys(e);Array.isArray(t)&&(t=t[0]);for(let i in o){const a=o[i];let s;s=!r.ignoreAttributes&&t.attrsMap&&t.attrsMap[a]?I(t.attrsMap[a],e[a],r):a===r.textNodeName?I(t.val,e[a],r):I(t.child[a],e[a],r),n=D(n,s)}}return n}return o}var n},V=function(t){switch(t){case void 0:return T.missingPremitive;case null:return T.nilPremitive;case"":return T.emptyValue;default:return t}},D=function(t,e){return L(e[0])||L(t[t.length-1])||(t+=T.boundryChar),t+e},L=function(t){return-1!==M.indexOf(t)};const B=r.buildOptions;var q={convert2nimn:function(t,e,r){return r=B(r,m.defaultOptions,m.props),I(t,e,r)}};const R=r.buildOptions,z=function(t,e,n){let o="{";const i=Object.keys(t.child);for(let r=0;r<i.length;r++){var a=i[r];if(t.child[a]&&t.child[a].length>1){for(var s in o+='"'+a+'" : [ ',t.child[a])o+=z(t.child[a][s],e)+" , ";o=o.substr(0,o.length-1)+" ] "}else o+='"'+a+'" : '+z(t.child[a][0],e)+" ,"}return r.merge(o,t.attrsMap),r.isEmptyObject(o)?r.isExist(t.val)?t.val:"":(r.isExist(t.val)&&("string"!=typeof t.val||""!==t.val&&t.val!==e.cdataPositionChar)&&(o+='"'+e.textNodeName+'" : '+(!0!==(u=t.val)&&!1!==u&&isNaN(u)?'"'+u+'"':u)),","===o[o.length-1]&&(o=o.substr(0,o.length-2)),o+"}");var u};var G={convertToJsonString:function(t,e){return(e=R(e,m.defaultOptions,m.props)).indentBy=e.indentBy||"",z(t,e)}};const U=r.buildOptions,J={attributeNamePrefix:"@_",attrNodeName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataTagName:!1,cdataPositionChar:"\\c",format:!1,indentBy:"  ",supressEmptyNode:!1,tagValueProcessor:function(t){return t},attrValueProcessor:function(t){return t}},$=["attributeNamePrefix","attrNodeName","textNodeName","ignoreAttributes","cdataTagName","cdataPositionChar","format","indentBy","supressEmptyNode","tagValueProcessor","attrValueProcessor"];function W(t){this.options=U(t,J,$),this.options.ignoreAttributes||this.options.attrNodeName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=et),this.options.cdataTagName?this.isCDATA=rt:this.isCDATA=function(){return!1},this.replaceCDATAstr=X,this.replaceCDATAarr=K,this.options.format?(this.indentate=tt,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine=""),this.options.supressEmptyNode?(this.buildTextNode=Q,this.buildObjNode=Z):(this.buildTextNode=H,this.buildObjNode=Y),this.buildTextValNode=H,this.buildObjectNode=Y}function X(t,e){return t=this.options.tagValueProcessor(""+t),""===this.options.cdataPositionChar||""===t?t+"<![CDATA["+e+"]]"+this.tagEndChar:t.replace(this.options.cdataPositionChar,"<![CDATA["+e+"]]"+this.tagEndChar)}function K(t,e){if(t=this.options.tagValueProcessor(""+t),""===this.options.cdataPositionChar||""===t)return t+"<![CDATA["+e.join("]]><![CDATA[")+"]]"+this.tagEndChar;for(let r in e)t=t.replace(this.options.cdataPositionChar,"<![CDATA["+e[r]+"]]>");return t+this.newLine}function Y(t,e,r,n){return r&&!t.includes("<")?this.indentate(n)+"<"+e+r+">"+t+"</"+e+this.tagEndChar:this.indentate(n)+"<"+e+r+this.tagEndChar+t+this.indentate(n)+"</"+e+this.tagEndChar}function Z(t,e,r,n){return""!==t?this.buildObjectNode(t,e,r,n):this.indentate(n)+"<"+e+r+"/"+this.tagEndChar}function H(t,e,r,n){return this.indentate(n)+"<"+e+r+">"+this.options.tagValueProcessor(t)+"</"+e+this.tagEndChar}function Q(t,e,r,n){return""!==t?this.buildTextValNode(t,e,r,n):this.indentate(n)+"<"+e+r+"/"+this.tagEndChar}function tt(t){return this.options.indentBy.repeat(t)}function et(t){return!!t.startsWith(this.options.attributeNamePrefix)&&t.substr(this.attrPrefixLen)}function rt(t){return t===this.options.cdataTagName}W.prototype.parse=function(t){return this.j2x(t,0).val},W.prototype.j2x=function(t,e){let r="",n="";const o=Object.keys(t),i=o.length;for(let a=0;a<i;a++){const i=o[a];if(void 0===t[i]);else if(null===t[i])n+=this.indentate(e)+"<"+i+"/"+this.tagEndChar;else if(t[i]instanceof Date)n+=this.buildTextNode(t[i],i,"",e);else if("object"!=typeof t[i]){const o=this.isAttribute(i);o?r+=" "+o+'="'+this.options.attrValueProcessor(""+t[i])+'"':this.isCDATA(i)?t[this.options.textNodeName]?n+=this.replaceCDATAstr(t[this.options.textNodeName],t[i]):n+=this.replaceCDATAstr("",t[i]):i===this.options.textNodeName?t[this.options.cdataTagName]||(n+=this.options.tagValueProcessor(""+t[i])):n+=this.buildTextNode(t[i],i,"",e)}else if(Array.isArray(t[i]))if(this.isCDATA(i))n+=this.indentate(e),t[this.options.textNodeName]?n+=this.replaceCDATAarr(t[this.options.textNodeName],t[i]):n+=this.replaceCDATAarr("",t[i]);else{const r=t[i].length;for(let o=0;o<r;o++){const r=t[i][o];if(void 0===r);else if(null===r)n+=this.indentate(e)+"<"+i+"/"+this.tagEndChar;else if("object"==typeof r){const t=this.j2x(r,e+1);n+=this.buildObjNode(t.val,i,t.attrStr,e)}else n+=this.buildTextNode(r,i,"",e)}}else if(this.options.attrNodeName&&i===this.options.attrNodeName){const e=Object.keys(t[i]),n=e.length;for(let o=0;o<n;o++)r+=" "+e[o]+'="'+this.options.attrValueProcessor(""+t[i][e[o]])+'"'}else{const r=this.j2x(t[i],e+1);n+=this.buildObjNode(r.val,i,r.attrStr,e)}}return{attrStr:r,val:n}};var nt=W,ot=e((function(t,e){const n=m,i=r.buildOptions;e.parse=function(t,e,r){if(r){!0===r&&(r={});const e=k(t,r);if(!0!==e)throw Error(e.err.msg)}e=i(e,n.defaultOptions,n.props);const a=m.getTraversalObj(t,e);return o.convertToJson(a,e)},e.convertTonimn=q.convert2nimn,e.getTraversalObj=m.getTraversalObj,e.convertToJson=o.convertToJson,e.convertToJsonString=G.convertToJsonString,e.validate=k,e.j2xParser=nt,e.parseToNimn=function(t,r,n){return e.convertTonimn(e.getTraversalObj(t,n),r,n)}}));function it(t,e,r){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!at(t[0])||!at(t[1]))throw new Error("coordinates must contain numbers");return function(t,e,r){if(!st(r=r||{}))throw new Error("options is invalid");var n=r.bbox,o=r.id;if(void 0===t)throw new Error("geometry is required");if(e&&e.constructor!==Object)throw new Error("properties must be an Object");n&&ut(n),o&&lt(o);var i={type:"Feature"};return o&&(i.id=o),n&&(i.bbox=n),i.properties=e||{},i.geometry=t,i}({type:"Point",coordinates:t},e,r)}function at(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function st(t){return!!t&&t.constructor===Object}function ut(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach((function(t){if(!at(t))throw new Error("bbox must only contain numbers")}))}function lt(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof t))throw new Error("id must be a number or a string")}function ct(t,e,r){if(null!==t)for(var n,o,i,a,s,u,l,c,f=0,p=0,h=t.type,g="FeatureCollection"===h,d="Feature"===h,y=g?t.features.length:1,b=0;b<y;b++){s=(c=!!(l=g?t.features[b].geometry:d?t.geometry:t)&&"GeometryCollection"===l.type)?l.geometries.length:1;for(var m=0;m<s;m++){var v=0,w=0;if(null!==(a=c?l.geometries[m]:l)){u=a.coordinates;var j=a.type;switch(f=!r||"Polygon"!==j&&"MultiPolygon"!==j?0:1,j){case null:break;case"Point":if(!1===e(u,p,b,v,w))return!1;p++,v++;break;case"LineString":case"MultiPoint":for(n=0;n<u.length;n++){if(!1===e(u[n],p,b,v,w))return!1;p++,"MultiPoint"===j&&v++}"LineString"===j&&v++;break;case"Polygon":case"MultiLineString":for(n=0;n<u.length;n++){for(o=0;o<u[n].length-f;o++){if(!1===e(u[n][o],p,b,v,w))return!1;p++}"MultiLineString"===j&&v++,"Polygon"===j&&w++}"Polygon"===j&&v++;break;case"MultiPolygon":for(n=0;n<u.length;n++){for("MultiPolygon"===j&&(w=0),o=0;o<u[n].length;o++){for(i=0;i<u[n][o].length-f;i++){if(!1===e(u[n][o][i],p,b,v,w))return!1;p++}w++}v++}break;case"GeometryCollection":for(n=0;n<a.geometries.length;n++)if(!1===ct(a.geometries[n],e,r))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function ft(t){var e=[];return"FeatureCollection"===t.type?function(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var r=0;r<t.features.length&&!1!==e(t.features[r],r);r++);}(t,(function(t){ct(t,(function(r){e.push(it(r,t.properties))}))})):ct(t,(function(r){e.push(it(r,t.properties))})),function(t,e){if(!st(e=e||{}))throw new Error("options is invalid");var r=e.bbox,n=e.id;if(!t)throw new Error("No features passed");if(!Array.isArray(t))throw new Error("features must be an Array");r&&ut(r),n&&lt(n);var o={type:"FeatureCollection"};return n&&(o.id=n),r&&(o.bbox=r),o.features=t,o}(e)}function pt(t,e,r){if(null!==t)for(var n,o,i,a,s,u,l,c,f=0,p=0,h=t.type,g="FeatureCollection"===h,d="Feature"===h,y=g?t.features.length:1,b=0;b<y;b++){s=(c=!!(l=g?t.features[b].geometry:d?t.geometry:t)&&"GeometryCollection"===l.type)?l.geometries.length:1;for(var m=0;m<s;m++){var v=0,w=0;if(null!==(a=c?l.geometries[m]:l)){u=a.coordinates;var j=a.type;switch(f=!r||"Polygon"!==j&&"MultiPolygon"!==j?0:1,j){case null:break;case"Point":if(!1===e(u,p,b,v,w))return!1;p++,v++;break;case"LineString":case"MultiPoint":for(n=0;n<u.length;n++){if(!1===e(u[n],p,b,v,w))return!1;p++,"MultiPoint"===j&&v++}"LineString"===j&&v++;break;case"Polygon":case"MultiLineString":for(n=0;n<u.length;n++){for(o=0;o<u[n].length-f;o++){if(!1===e(u[n][o],p,b,v,w))return!1;p++}"MultiLineString"===j&&v++,"Polygon"===j&&w++}"Polygon"===j&&v++;break;case"MultiPolygon":for(n=0;n<u.length;n++){for("MultiPolygon"===j&&(w=0),o=0;o<u[n].length;o++){for(i=0;i<u[n][o].length-f;i++){if(!1===e(u[n][o][i],p,b,v,w))return!1;p++}w++}v++}break;case"GeometryCollection":for(n=0;n<a.geometries.length;n++)if(!1===pt(a.geometries[n],e,r))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function ht(t){var e=[1/0,1/0,-1/0,-1/0];return pt(t,(function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])})),e}function gt(t,e,r){if(!yt(r=r||{}))throw new Error("options is invalid");var n=r.bbox,o=r.id;if(void 0===t)throw new Error("geometry is required");if(e&&e.constructor!==Object)throw new Error("properties must be an Object");n&&function(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach((function(t){if(!dt(t))throw new Error("bbox must only contain numbers")}))}(n),o&&function(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof t))throw new Error("id must be a number or a string")}(o);var i={type:"Feature"};return o&&(i.id=o),n&&(i.bbox=n),i.properties=e||{},i.geometry=t,i}function dt(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function yt(t){return!!t&&t.constructor===Object}function bt(t,e){if(!yt(e=e||{}))throw new Error("options is invalid");var r=e.properties;if(!t)throw new Error("geojson is required");var n=ht(t);return function(t,e,r){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!dt(t[0])||!dt(t[1]))throw new Error("coordinates must contain numbers");return gt({type:"Point",coordinates:t},e,r)}([(n[0]+n[2])/2,(n[1]+n[3])/2],r)}function mt(t){if(!t)throw new Error("geojson is required");switch(t.type){case"Feature":return vt(t);case"FeatureCollection":return function(t){var e={type:"FeatureCollection"};return Object.keys(t).forEach((function(r){switch(r){case"type":case"features":return;default:e[r]=t[r]}})),e.features=t.features.map((function(t){return vt(t)})),e}(t);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return jt(t);default:throw new Error("unknown GeoJSON type")}}function vt(t){var e={type:"Feature"};return Object.keys(t).forEach((function(r){switch(r){case"type":case"properties":case"geometry":return;default:e[r]=t[r]}})),e.properties=wt(t.properties),e.geometry=jt(t.geometry),e}function wt(t){var e={};return t?(Object.keys(t).forEach((function(r){var n=t[r];"object"==typeof n?null===n?e[r]=null:n.length?e[r]=n.map((function(t){return t})):e[r]=wt(n):e[r]=n})),e):e}function jt(t){var e={type:t.type};return t.bbox&&(e.bbox=t.bbox),"GeometryCollection"===t.type?(e.geometries=t.geometries.map((function(t){return jt(t)})),e):(e.coordinates=At(t.coordinates),e)}function At(t){return"object"!=typeof t[0]?t.slice():t.map((function(t){return At(t)}))}ot.parse,ot.convertTonimn,ot.getTraversalObj,ot.convertToJson,ot.convertToJsonString,ot.validate,ot.j2xParser,ot.parseToNimn;var Et={meters:6371008.8,metres:6371008.8,millimeters:6371008800,millimetres:6371008800,centimeters:637100880,centimetres:637100880,kilometers:6371.0088,kilometres:6371.0088,miles:3958.761333810546,nauticalmiles:6371008.8/1852,inches:6371008.8*39.37,yards:6371008.8/1.0936,feet:20902260.511392,radians:1,degrees:6371008.8/111325};function xt(t){if(null==t)throw new Error("degrees is required");return t%360*Math.PI/180}function _t(t){if(!t)throw new Error("coord is required");if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return t.geometry.coordinates;if("Point"===t.type)return t.coordinates;if(Array.isArray(t)&&t.length>=2&&void 0===t[0].length&&void 0===t[1].length)return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ot(t,e,r){if(!(n=r=r||{})||n.constructor!==Object)throw new Error("options is invalid");var n,o=r.units,i=_t(t),a=_t(e),s=xt(a[1]-i[1]),u=xt(a[0]-i[0]),l=xt(i[1]),c=xt(a[1]),f=Math.pow(Math.sin(s/2),2)+Math.pow(Math.sin(u/2),2)*Math.cos(l)*Math.cos(c);return function(t,e){if(null==t)throw new Error("radians is required");if(e&&"string"!=typeof e)throw new Error("units must be a string");var r=Et[e||"kilometers"];if(!r)throw new Error(e+" units is invalid");return t*r}(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),o)}function Nt(t,e,r){if(!St(r=r||{}))throw new Error("options is invalid");var n=r.bbox,o=r.id;if(void 0===t)throw new Error("geometry is required");if(e&&e.constructor!==Object)throw new Error("properties must be an Object");n&&kt(n),o&&Ft(o);var i={type:"Feature"};return o&&(i.id=o),n&&(i.bbox=n),i.properties=e||{},i.geometry=t,i}function Pt(t,e){if(!St(e=e||{}))throw new Error("options is invalid");var r=e.bbox,n=e.id;if(!t)throw new Error("No features passed");if(!Array.isArray(t))throw new Error("features must be an Array");r&&kt(r),n&&Ft(n);var o={type:"FeatureCollection"};return n&&(o.id=n),r&&(o.bbox=r),o.features=t,o}function Ct(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function St(t){return!!t&&t.constructor===Object}function kt(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach((function(t){if(!Ct(t))throw new Error("bbox must only contain numbers")}))}function Ft(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof t))throw new Error("id must be a number or a string")}function Tt(t,e,r){if("object"!=typeof(r=r||{}))throw new Error("options is invalid");var n=r.ignoreBoundary;if(!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");var o=function(t){if(!t)throw new Error("coord is required");if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return t.geometry.coordinates;if("Point"===t.type)return t.coordinates;if(Array.isArray(t)&&t.length>=2&&void 0===t[0].length&&void 0===t[1].length)return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}(t),i=function(t){if(!t)throw new Error("coords is required");if("Feature"===t.type&&null!==t.geometry)return t.geometry.coordinates;if(t.coordinates)return t.coordinates;if(Array.isArray(t))return t;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}(e),a=e.geometry?e.geometry.type:e.type,s=e.bbox;if(s&&!1===function(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}(o,s))return!1;"Polygon"===a&&(i=[i]);for(var u=0,l=!1;u<i.length&&!l;u++)if(Mt(o,i[u][0],n)){for(var c=!1,f=1;f<i[u].length&&!c;)Mt(o,i[u][f],!n)&&(c=!0),f++;c||(l=!0)}return l}function Mt(t,e,r){var n=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var o=0,i=e.length-1;o<e.length;i=o++){var a=e[o][0],s=e[o][1],u=e[i][0],l=e[i][1];if(t[1]*(a-u)+s*(u-t[0])+l*(t[0]-a)==0&&(a-t[0])*(u-t[0])<=0&&(s-t[1])*(l-t[1])<=0)return!r;s>t[1]!=l>t[1]&&t[0]<(u-a)*(t[1]-s)/(l-s)+a&&(n=!n)}return n}function It(t){for(var e=function(t){if("FeatureCollection"!==t.type)return"Feature"!==t.type?Pt([Nt(t)]):Pt([t]);return t}(t),r=bt(e),n=!1,o=0;!n&&o<e.features.length;){var i,a=e.features[o].geometry,s=!1;if("Point"===a.type)r.geometry.coordinates[0]===a.coordinates[0]&&r.geometry.coordinates[1]===a.coordinates[1]&&(n=!0);else if("MultiPoint"===a.type){var u=!1;for(i=0;!u&&i<a.coordinates.length;)r.geometry.coordinates[0]===a.coordinates[i][0]&&r.geometry.coordinates[1]===a.coordinates[i][1]&&(n=!0,u=!0),i++}else if("LineString"===a.type)for(i=0;!s&&i<a.coordinates.length-1;)Vt(r.geometry.coordinates[0],r.geometry.coordinates[1],a.coordinates[i][0],a.coordinates[i][1],a.coordinates[i+1][0],a.coordinates[i+1][1])&&(s=!0,n=!0),i++;else if("MultiLineString"===a.type)for(var l=0;l<a.coordinates.length;){s=!1,i=0;for(var c=a.coordinates[l];!s&&i<c.length-1;)Vt(r.geometry.coordinates[0],r.geometry.coordinates[1],c[i][0],c[i][1],c[i+1][0],c[i+1][1])&&(s=!0,n=!0),i++;l++}else"Polygon"!==a.type&&"MultiPolygon"!==a.type||Tt(r,a)&&(n=!0);o++}if(n)return r;var f=Pt([]);for(o=0;o<e.features.length;o++)f.features=f.features.concat(ft(e.features[o]).features);return function(t,e,r){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ct(t[0])||!Ct(t[1]))throw new Error("coordinates must contain numbers");return Nt({type:"Point",coordinates:t},e,r)}(function(t,e){if(!t)throw new Error("targetPoint is required");if(!e)throw new Error("points is required");var r,n=1/0;return function(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var r=0;r<t.features.length&&!1!==e(t.features[r],r);r++);}(e,(function(e,o){var i=Ot(t,e);i<n&&((r=mt(e)).properties.featureIndex=o,r.properties.distanceToPoint=i,n=i)})),r}(r,f).geometry.coordinates)}function Vt(t,e,r,n,o,i){return Math.sqrt((o-r)*(o-r)+(i-n)*(i-n))===Math.sqrt((t-r)*(t-r)+(e-n)*(e-n))+Math.sqrt((o-t)*(o-t)+(i-e)*(i-e))}function Dt(t,e,r){var n=r;return function(t,e){var r,n,o,i,a,s,u,l,c,f,p=0,h="FeatureCollection"===t.type,g="Feature"===t.type,d=h?t.features.length:1;for(r=0;r<d;r++){for(s=h?t.features[r].geometry:g?t.geometry:t,l=h?t.features[r].properties:g?t.properties:{},c=h?t.features[r].bbox:g?t.bbox:void 0,f=h?t.features[r].id:g?t.id:void 0,a=(u=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,o=0;o<a;o++)if(null!==(i=u?s.geometries[o]:s))switch(i.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(i,p,l,c,f))return!1;break;case"GeometryCollection":for(n=0;n<i.geometries.length;n++)if(!1===e(i.geometries[n],p,l,c,f))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,p,l,c,f))return!1;p++}}(t,(function(t,o,i,a,s){n=0===o&&void 0===r?t:e(n,t,o,i,a,s)})),n}function Lt(t){return Dt(t,(function(t,e){return t+function(t){var e,r=0;switch(t.type){case"Polygon":return Bt(t.coordinates);case"MultiPolygon":for(e=0;e<t.coordinates.length;e++)r+=Bt(t.coordinates[e]);return r;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}(e)}),0)}function Bt(t){var e=0;if(t&&t.length>0){e+=Math.abs(qt(t[0]));for(var r=1;r<t.length;r++)e-=Math.abs(qt(t[r]))}return e}function qt(t){var e,r,n,o,i,a,s=0,u=t.length;if(u>2){for(a=0;a<u;a++)a===u-2?(n=u-2,o=u-1,i=0):a===u-1?(n=u-1,o=0,i=1):(n=a,o=a+1,i=a+2),e=t[n],r=t[o],s+=(Rt(t[i][0])-Rt(e[0]))*Math.sin(Rt(r[1]));s=6378137*s*6378137/2}return s}function Rt(t){return t*Math.PI/180}function zt(t,e,r){if(void 0===r&&(r={}),!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");var n,o=function(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return t.geometry.coordinates;if("Point"===t.type)return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}(t),i="Feature"===(n=e).type?n.geometry:n,a=i.type,s=e.bbox,u=i.coordinates;if(s&&!1===function(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}(o,s))return!1;"Polygon"===a&&(u=[u]);for(var l=!1,c=0;c<u.length&&!l;c++)if(Gt(o,u[c][0],r.ignoreBoundary)){for(var f=!1,p=1;p<u[c].length&&!f;)Gt(o,u[c][p],!r.ignoreBoundary)&&(f=!0),p++;f||(l=!0)}return l}function Gt(t,e,r){var n=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var o=0,i=e.length-1;o<e.length;i=o++){var a=e[o][0],s=e[o][1],u=e[i][0],l=e[i][1];if(t[1]*(a-u)+s*(u-t[0])+l*(t[0]-a)==0&&(a-t[0])*(u-t[0])<=0&&(s-t[1])*(l-t[1])<=0)return!r;s>t[1]!=l>t[1]&&t[0]<(u-a)*(t[1]-s)/(l-s)+a&&(n=!n)}return n}function Ut(t,e){void 0===e&&(e={});var r=Number(t[0]),n=Number(t[1]),o=Number(t[2]),i=Number(t[3]);if(6===t.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var a=[r,n];return function(t,e,r){void 0===r&&(r={});for(var n=0,o=t;n<o.length;n++){var i=o[n];if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<i[i.length-1].length;a++)if(i[i.length-1][a]!==i[0][a])throw new Error("First and last Position are not equivalent.")}return function(t,e,r){void 0===r&&(r={});var n={type:"Feature"};return(0===r.id||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=e||{},n.geometry=t,n}({type:"Polygon",coordinates:t},e,r)}([[a,[o,n],[o,i],[r,i],a]],e.properties,{bbox:t,id:e.id})}var Jt=function(){this.__data__=[],this.size=0};var $t=function(t,e){return t===e||t!=t&&e!=e};var Wt=function(t,e){for(var r=t.length;r--;)if($t(t[r][0],e))return r;return-1},Xt=Array.prototype.splice;var Kt=function(t){var e=this.__data__,r=Wt(e,t);return!(r<0)&&(r==e.length-1?e.pop():Xt.call(e,r,1),--this.size,!0)};var Yt=function(t){var e=this.__data__,r=Wt(e,t);return r<0?void 0:e[r][1]};var Zt=function(t){return Wt(this.__data__,t)>-1};var Ht=function(t,e){var r=this.__data__,n=Wt(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};function Qt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Qt.prototype.clear=Jt,Qt.prototype.delete=Kt,Qt.prototype.get=Yt,Qt.prototype.has=Zt,Qt.prototype.set=Ht;var te=Qt;var ee=function(){this.__data__=new te,this.size=0};var re=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r};var ne=function(t){return this.__data__.get(t)};var oe=function(t){return this.__data__.has(t)},ie="object"==typeof t&&t&&t.Object===Object&&t,ae="object"==typeof self&&self&&self.Object===Object&&self,se=ie||ae||Function("return this")(),ue=se.Symbol,le=Object.prototype,ce=le.hasOwnProperty,fe=le.toString,pe=ue?ue.toStringTag:void 0;var he=function(t){var e=ce.call(t,pe),r=t[pe];try{t[pe]=void 0;var n=!0}catch(t){}var o=fe.call(t);return n&&(e?t[pe]=r:delete t[pe]),o},ge=Object.prototype.toString;var de=function(t){return ge.call(t)},ye=ue?ue.toStringTag:void 0;var be=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":ye&&ye in Object(t)?he(t):de(t)};var me=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)};var ve,we=function(t){if(!me(t))return!1;var e=be(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},je=se["__core-js_shared__"],Ae=(ve=/[^.]+$/.exec(je&&je.keys&&je.keys.IE_PROTO||""))?"Symbol(src)_1."+ve:"";var Ee=function(t){return!!Ae&&Ae in t},xe=Function.prototype.toString;var _e=function(t){if(null!=t){try{return xe.call(t)}catch(t){}try{return t+""}catch(t){}}return""},Oe=/^\[object .+?Constructor\]$/,Ne=Function.prototype,Pe=Object.prototype,Ce=Ne.toString,Se=Pe.hasOwnProperty,ke=RegExp("^"+Ce.call(Se).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Fe=function(t){return!(!me(t)||Ee(t))&&(we(t)?ke:Oe).test(_e(t))};var Te=function(t,e){return null==t?void 0:t[e]};var Me=function(t,e){var r=Te(t,e);return Fe(r)?r:void 0},Ie=Me(se,"Map"),Ve=Me(Object,"create");var De=function(){this.__data__=Ve?Ve(null):{},this.size=0};var Le=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Be=Object.prototype.hasOwnProperty;var qe=function(t){var e=this.__data__;if(Ve){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return Be.call(e,t)?e[t]:void 0},Re=Object.prototype.hasOwnProperty;var ze=function(t){var e=this.__data__;return Ve?void 0!==e[t]:Re.call(e,t)};var Ge=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=Ve&&void 0===e?"__lodash_hash_undefined__":e,this};function Ue(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Ue.prototype.clear=De,Ue.prototype.delete=Le,Ue.prototype.get=qe,Ue.prototype.has=ze,Ue.prototype.set=Ge;var Je=Ue;var $e=function(){this.size=0,this.__data__={hash:new Je,map:new(Ie||te),string:new Je}};var We=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var Xe=function(t,e){var r=t.__data__;return We(e)?r["string"==typeof e?"string":"hash"]:r.map};var Ke=function(t){var e=Xe(this,t).delete(t);return this.size-=e?1:0,e};var Ye=function(t){return Xe(this,t).get(t)};var Ze=function(t){return Xe(this,t).has(t)};var He=function(t,e){var r=Xe(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};function Qe(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Qe.prototype.clear=$e,Qe.prototype.delete=Ke,Qe.prototype.get=Ye,Qe.prototype.has=Ze,Qe.prototype.set=He;var tr=Qe;var er=function(t,e){var r=this.__data__;if(r instanceof te){var n=r.__data__;if(!Ie||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new tr(n)}return r.set(t,e),this.size=r.size,this};function rr(t){var e=this.__data__=new te(t);this.size=e.size}rr.prototype.clear=ee,rr.prototype.delete=re,rr.prototype.get=ne,rr.prototype.has=oe,rr.prototype.set=er;var nr=rr;var or=function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n&&!1!==e(t[r],r,t););return t},ir=function(){try{var t=Me(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();var ar=function(t,e,r){"__proto__"==e&&ir?ir(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r},sr=Object.prototype.hasOwnProperty;var ur=function(t,e,r){var n=t[e];sr.call(t,e)&&$t(n,r)&&(void 0!==r||e in t)||ar(t,e,r)};var lr=function(t,e,r,n){var o=!r;r||(r={});for(var i=-1,a=e.length;++i<a;){var s=e[i],u=n?n(r[s],t[s],s,r,t):void 0;void 0===u&&(u=t[s]),o?ar(r,s,u):ur(r,s,u)}return r};var cr=function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n};var fr=function(t){return null!=t&&"object"==typeof t};var pr=function(t){return fr(t)&&"[object Arguments]"==be(t)},hr=Object.prototype,gr=hr.hasOwnProperty,dr=hr.propertyIsEnumerable,yr=pr(function(){return arguments}())?pr:function(t){return fr(t)&&gr.call(t,"callee")&&!dr.call(t,"callee")},br=Array.isArray;var mr=function(){return!1},vr=e((function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r?se.Buffer:void 0,i=(o?o.isBuffer:void 0)||mr;t.exports=i})),wr=/^(?:0|[1-9]\d*)$/;var jr=function(t,e){var r=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&wr.test(t))&&t>-1&&t%1==0&&t<e};var Ar=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991},Er={};Er["[object Float32Array]"]=Er["[object Float64Array]"]=Er["[object Int8Array]"]=Er["[object Int16Array]"]=Er["[object Int32Array]"]=Er["[object Uint8Array]"]=Er["[object Uint8ClampedArray]"]=Er["[object Uint16Array]"]=Er["[object Uint32Array]"]=!0,Er["[object Arguments]"]=Er["[object Array]"]=Er["[object ArrayBuffer]"]=Er["[object Boolean]"]=Er["[object DataView]"]=Er["[object Date]"]=Er["[object Error]"]=Er["[object Function]"]=Er["[object Map]"]=Er["[object Number]"]=Er["[object Object]"]=Er["[object RegExp]"]=Er["[object Set]"]=Er["[object String]"]=Er["[object WeakMap]"]=!1;var xr=function(t){return fr(t)&&Ar(t.length)&&!!Er[be(t)]};var _r=function(t){return function(e){return t(e)}},Or=e((function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r&&ie.process,i=function(){try{var t=n&&n.require&&n.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=i})),Nr=Or&&Or.isTypedArray,Pr=Nr?_r(Nr):xr,Cr=Object.prototype.hasOwnProperty;var Sr=function(t,e){var r=br(t),n=!r&&yr(t),o=!r&&!n&&vr(t),i=!r&&!n&&!o&&Pr(t),a=r||n||o||i,s=a?cr(t.length,String):[],u=s.length;for(var l in t)!e&&!Cr.call(t,l)||a&&("length"==l||o&&("offset"==l||"parent"==l)||i&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||jr(l,u))||s.push(l);return s},kr=Object.prototype;var Fr=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||kr)};var Tr=function(t,e){return function(r){return t(e(r))}},Mr=Tr(Object.keys,Object),Ir=Object.prototype.hasOwnProperty;var Vr=function(t){if(!Fr(t))return Mr(t);var e=[];for(var r in Object(t))Ir.call(t,r)&&"constructor"!=r&&e.push(r);return e};var Dr=function(t){return null!=t&&Ar(t.length)&&!we(t)};var Lr=function(t){return Dr(t)?Sr(t):Vr(t)};var Br=function(t,e){return t&&lr(e,Lr(e),t)};var qr=function(t){var e=[];if(null!=t)for(var r in Object(t))e.push(r);return e},Rr=Object.prototype.hasOwnProperty;var zr=function(t){if(!me(t))return qr(t);var e=Fr(t),r=[];for(var n in t)("constructor"!=n||!e&&Rr.call(t,n))&&r.push(n);return r};var Gr=function(t){return Dr(t)?Sr(t,!0):zr(t)};var Ur=function(t,e){return t&&lr(e,Gr(e),t)},Jr=e((function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r?se.Buffer:void 0,i=o?o.allocUnsafe:void 0;t.exports=function(t,e){if(e)return t.slice();var r=t.length,n=i?i(r):new t.constructor(r);return t.copy(n),n}}));var $r=function(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e};var Wr=function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,i=[];++r<n;){var a=t[r];e(a,r,t)&&(i[o++]=a)}return i};var Xr=function(){return[]},Kr=Object.prototype.propertyIsEnumerable,Yr=Object.getOwnPropertySymbols,Zr=Yr?function(t){return null==t?[]:(t=Object(t),Wr(Yr(t),(function(e){return Kr.call(t,e)})))}:Xr;var Hr=function(t,e){return lr(t,Zr(t),e)};var Qr=function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t},tn=Tr(Object.getPrototypeOf,Object),en=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)Qr(e,Zr(t)),t=tn(t);return e}:Xr;var rn=function(t,e){return lr(t,en(t),e)};var nn=function(t,e,r){var n=e(t);return br(t)?n:Qr(n,r(t))};var on=function(t){return nn(t,Lr,Zr)};var an=function(t){return nn(t,Gr,en)},sn=Me(se,"DataView"),un=Me(se,"Promise"),ln=Me(se,"Set"),cn=Me(se,"WeakMap"),fn=_e(sn),pn=_e(Ie),hn=_e(un),gn=_e(ln),dn=_e(cn),yn=be;(sn&&"[object DataView]"!=yn(new sn(new ArrayBuffer(1)))||Ie&&"[object Map]"!=yn(new Ie)||un&&"[object Promise]"!=yn(un.resolve())||ln&&"[object Set]"!=yn(new ln)||cn&&"[object WeakMap]"!=yn(new cn))&&(yn=function(t){var e=be(t),r="[object Object]"==e?t.constructor:void 0,n=r?_e(r):"";if(n)switch(n){case fn:return"[object DataView]";case pn:return"[object Map]";case hn:return"[object Promise]";case gn:return"[object Set]";case dn:return"[object WeakMap]"}return e});var bn=yn,mn=Object.prototype.hasOwnProperty;var vn=function(t){var e=t.length,r=new t.constructor(e);return e&&"string"==typeof t[0]&&mn.call(t,"index")&&(r.index=t.index,r.input=t.input),r},wn=se.Uint8Array;var jn=function(t){var e=new t.constructor(t.byteLength);return new wn(e).set(new wn(t)),e};var An=function(t,e){var r=e?jn(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)},En=/\w*$/;var xn=function(t){var e=new t.constructor(t.source,En.exec(t));return e.lastIndex=t.lastIndex,e},_n=ue?ue.prototype:void 0,On=_n?_n.valueOf:void 0;var Nn=function(t){return On?Object(On.call(t)):{}};var Pn=function(t,e){var r=e?jn(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)};var Cn=function(t,e,r){var n=t.constructor;switch(e){case"[object ArrayBuffer]":return jn(t);case"[object Boolean]":case"[object Date]":return new n(+t);case"[object DataView]":return An(t,r);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return Pn(t,r);case"[object Map]":return new n;case"[object Number]":case"[object String]":return new n(t);case"[object RegExp]":return xn(t);case"[object Set]":return new n;case"[object Symbol]":return Nn(t)}},Sn=Object.create,kn=function(){function t(){}return function(e){if(!me(e))return{};if(Sn)return Sn(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}();var Fn=function(t){return"function"!=typeof t.constructor||Fr(t)?{}:kn(tn(t))};var Tn=function(t){return fr(t)&&"[object Map]"==bn(t)},Mn=Or&&Or.isMap,In=Mn?_r(Mn):Tn;var Vn=function(t){return fr(t)&&"[object Set]"==bn(t)},Dn=Or&&Or.isSet,Ln=Dn?_r(Dn):Vn,Bn={};Bn["[object Arguments]"]=Bn["[object Array]"]=Bn["[object ArrayBuffer]"]=Bn["[object DataView]"]=Bn["[object Boolean]"]=Bn["[object Date]"]=Bn["[object Float32Array]"]=Bn["[object Float64Array]"]=Bn["[object Int8Array]"]=Bn["[object Int16Array]"]=Bn["[object Int32Array]"]=Bn["[object Map]"]=Bn["[object Number]"]=Bn["[object Object]"]=Bn["[object RegExp]"]=Bn["[object Set]"]=Bn["[object String]"]=Bn["[object Symbol]"]=Bn["[object Uint8Array]"]=Bn["[object Uint8ClampedArray]"]=Bn["[object Uint16Array]"]=Bn["[object Uint32Array]"]=!0,Bn["[object Error]"]=Bn["[object Function]"]=Bn["[object WeakMap]"]=!1;var qn=function t(e,r,n,o,i,a){var s,u=1&r,l=2&r,c=4&r;if(n&&(s=i?n(e,o,i,a):n(e)),void 0!==s)return s;if(!me(e))return e;var f=br(e);if(f){if(s=vn(e),!u)return $r(e,s)}else{var p=bn(e),h="[object Function]"==p||"[object GeneratorFunction]"==p;if(vr(e))return Jr(e,u);if("[object Object]"==p||"[object Arguments]"==p||h&&!i){if(s=l||h?{}:Fn(e),!u)return l?rn(e,Ur(s,e)):Hr(e,Br(s,e))}else{if(!Bn[p])return i?e:{};s=Cn(e,p,u)}}a||(a=new nr);var g=a.get(e);if(g)return g;a.set(e,s),Ln(e)?e.forEach((function(o){s.add(t(o,r,n,o,e,a))})):In(e)&&e.forEach((function(o,i){s.set(i,t(o,r,n,i,e,a))}));var d=f?void 0:(c?l?an:on:l?Gr:Lr)(e);return or(d||e,(function(o,i){d&&(o=e[i=o]),ur(s,i,t(o,r,n,i,e,a))})),s};var Rn=function(t){return qn(t,4)};function zn(t,e){return t>e?1:t<e?-1:0}class Gn{constructor(t=zn,e=!1){this._compare=t,this._root=null,this._size=0,this._noDuplicates=!!e}rotateLeft(t){var e=t.right;e&&(t.right=e.left,e.left&&(e.left.parent=t),e.parent=t.parent),t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.left=t),t.parent=e}rotateRight(t){var e=t.left;e&&(t.left=e.right,e.right&&(e.right.parent=t),e.parent=t.parent),t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.right=t),t.parent=e}_splay(t){for(;t.parent;){var e=t.parent;e.parent?e.left===t&&e.parent.left===e?(this.rotateRight(e.parent),this.rotateRight(e)):e.right===t&&e.parent.right===e?(this.rotateLeft(e.parent),this.rotateLeft(e)):e.left===t&&e.parent.right===e?(this.rotateRight(e),this.rotateLeft(e)):(this.rotateLeft(e),this.rotateRight(e)):e.left===t?this.rotateRight(e):this.rotateLeft(e)}}splay(t){for(var e,r,n,o,i;t.parent;)(r=(e=t.parent).parent)&&r.parent?((n=r.parent).left===r?n.left=t:n.right=t,t.parent=n):(t.parent=null,this._root=t),o=t.left,i=t.right,t===e.left?(r&&(r.left===e?(e.right?(r.left=e.right,r.left.parent=r):r.left=null,e.right=r,r.parent=e):(o?(r.right=o,o.parent=r):r.right=null,t.left=r,r.parent=t)),i?(e.left=i,i.parent=e):e.left=null,t.right=e,e.parent=t):(r&&(r.right===e?(e.left?(r.right=e.left,r.right.parent=r):r.right=null,e.left=r,r.parent=e):(i?(r.left=i,i.parent=r):r.left=null,t.right=r,r.parent=t)),o?(e.right=o,o.parent=e):e.right=null,t.left=e,e.parent=t)}replace(t,e){t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.parent=t.parent)}minNode(t=this._root){if(t)for(;t.left;)t=t.left;return t}maxNode(t=this._root){if(t)for(;t.right;)t=t.right;return t}insert(t,e){var r=this._root,n=null,o=this._compare;if(this._noDuplicates)for(;r;){if(n=r,0===o(r.key,t))return;r=o(r.key,t)<0?r.right:r.left}else for(;r;)n=r,r=o(r.key,t)<0?r.right:r.left;return r={key:t,data:e,left:null,right:null,parent:n},n?o(n.key,r.key)<0?n.right=r:n.left=r:this._root=r,this.splay(r),this._size++,r}find(t){for(var e=this._root,r=this._compare;e;){var n=r(e.key,t);if(n<0)e=e.right;else{if(!(n>0))return e;e=e.left}}return null}contains(t){for(var e=this._root,r=this._compare;e;){var n=r(t,e.key);if(0===n)return!0;e=n<0?e.left:e.right}return!1}remove(t){var e=this.find(t);if(!e)return!1;if(this.splay(e),e.left)if(e.right){var r=this.minNode(e.right);r.parent!==e&&(this.replace(r,r.right),r.right=e.right,r.right.parent=r),this.replace(e,r),r.left=e.left,r.left.parent=r}else this.replace(e,e.left);else this.replace(e,e.right);return this._size--,!0}removeNode(t){if(!t)return!1;if(this.splay(t),t.left)if(t.right){var e=this.minNode(t.right);e.parent!==t&&(this.replace(e,e.right),e.right=t.right,e.right.parent=e),this.replace(t,e),e.left=t.left,e.left.parent=e}else this.replace(t,t.left);else this.replace(t,t.right);return this._size--,!0}erase(t){var e=this.find(t);if(e){this.splay(e);var r=e.left,n=e.right,o=null;r&&(r.parent=null,o=this.maxNode(r),this.splay(o),this._root=o),n&&(r?o.right=n:this._root=n,n.parent=o),this._size--}}pop(){var t=this._root,e=null;if(t){for(;t.left;)t=t.left;e={key:t.key,data:t.data},this.remove(t.key)}return e}next(t){var e=t;if(e)if(e.right)for(e=e.right;e&&e.left;)e=e.left;else for(e=t.parent;e&&e.right===t;)t=e,e=e.parent;return e}prev(t){var e=t;if(e)if(e.left)for(e=e.left;e&&e.right;)e=e.right;else for(e=t.parent;e&&e.left===t;)t=e,e=e.parent;return e}forEach(t){for(var e=this._root,r=[],n=!1,o=0;!n;)e?(r.push(e),e=e.left):r.length>0?(t(e=r.pop(),o++),e=e.right):n=!0;return this}range(t,e,r,n){const o=[],i=this._compare;let a,s=this._root;for(;0!==o.length||s;)if(s)o.push(s),s=s.left;else{if(s=o.pop(),a=i(s.key,e),a>0)break;if(i(s.key,t)>=0&&r.call(n,s))return this;s=s.right}return this}keys(){for(var t=this._root,e=[],r=[],n=!1;!n;)t?(e.push(t),t=t.left):e.length>0?(t=e.pop(),r.push(t.key),t=t.right):n=!0;return r}values(){for(var t=this._root,e=[],r=[],n=!1;!n;)t?(e.push(t),t=t.left):e.length>0?(t=e.pop(),r.push(t.data),t=t.right):n=!0;return r}at(t){for(var e=this._root,r=[],n=!1,o=0;!n;)if(e)r.push(e),e=e.left;else if(r.length>0){if(e=r.pop(),o===t)return e;o++,e=e.right}else n=!0;return null}load(t=[],e=[],r=!1){if(0!==this._size)throw new Error("bulk-load: tree is not empty");const n=t.length;return r&&Jn(t,e,0,n-1,this._compare),this._root=Un(null,t,e,0,n),this._size=n,this}min(){var t=this.minNode(this._root);return t?t.key:null}max(){var t=this.maxNode(this._root);return t?t.key:null}isEmpty(){return null===this._root}get size(){return this._size}static createTree(t,e,r,n,o){return new Gn(r,o).load(t,e,n)}}function Un(t,e,r,n,o){const i=o-n;if(i>0){const a=n+Math.floor(i/2),s={key:e[a],data:r[a],parent:t};return s.left=Un(s,e,r,n,a),s.right=Un(s,e,r,a+1,o),s}return null}function Jn(t,e,r,n,o){if(r>=n)return;const i=t[r+n>>1];let a=r-1,s=n+1;for(;;){do{a++}while(o(t[a],i)<0);do{s--}while(o(t[s],i)>0);if(a>=s)break;let r=t[a];t[a]=t[s],t[s]=r,r=e[a],e[a]=e[s],e[s]=r}Jn(t,e,r,s,o),Jn(t,e,s+1,n,o)}function $n(t,e,r){null===e?(t.inOut=!1,t.otherInOut=!0):(t.isSubject===e.isSubject?(t.inOut=!e.inOut,t.otherInOut=e.otherInOut):(t.inOut=!e.otherInOut,t.otherInOut=e.isVertical()?!e.inOut:e.inOut),e&&(t.prevInResult=!Wn(e,r)||e.isVertical()?e.prevInResult:e)),t.inResult=Wn(t,r)}function Wn(t,e){switch(t.type){case 0:switch(e){case 0:return!t.otherInOut;case 1:return t.otherInOut;case 2:return t.isSubject&&t.otherInOut||!t.isSubject&&!t.otherInOut;case 3:return!0}break;case 2:return 0===e||1===e;case 3:return 2===e;case 1:return!1}return!1}class Xn{constructor(t,e,r,n,o){this.left=e,this.point=t,this.otherEvent=r,this.isSubject=n,this.type=o||0,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.inResult=!1,this.resultInOut=!1,this.isExteriorRing=!0}isBelow(t){const e=this.point,r=this.otherEvent.point;return this.left?(e[0]-t[0])*(r[1]-t[1])-(r[0]-t[0])*(e[1]-t[1])>0:(r[0]-t[0])*(e[1]-t[1])-(e[0]-t[0])*(r[1]-t[1])>0}isAbove(t){return!this.isBelow(t)}isVertical(){return this.point[0]===this.otherEvent.point[0]}clone(){const t=new Xn(this.point,this.left,this.otherEvent,this.isSubject,this.type);return t.inResult=this.inResult,t.prevInResult=this.prevInResult,t.isExteriorRing=this.isExteriorRing,t.inOut=this.inOut,t.otherInOut=this.otherInOut,t}}function Kn(t,e){return t[0]===e[0]&&t[1]===e[1]}function Yn(t,e,r){return(t[0]-r[0])*(e[1]-r[1])-(e[0]-r[0])*(t[1]-r[1])}function Zn(t,e){const r=t.point,n=e.point;return r[0]>n[0]?1:r[0]<n[0]?-1:r[1]!==n[1]?r[1]>n[1]?1:-1:function(t,e,r,n){if(t.left!==e.left)return t.left?1:-1;if(0!==Yn(r,t.otherEvent.point,e.otherEvent.point))return t.isBelow(e.otherEvent.point)?-1:1;return!t.isSubject&&e.isSubject?1:-1}(t,e,r)}function Hn(t,e,r){const n=new Xn(e,!1,t,t.isSubject),o=new Xn(e,!0,t.otherEvent,t.isSubject);return Kn(t.point,t.otherEvent.point)&&console.warn("what is that, a collapsed segment?",t),n.contourId=o.contourId=t.contourId,Zn(o,t.otherEvent)>0&&(t.otherEvent.left=!0,o.left=!1),t.otherEvent.otherEvent=o,t.otherEvent=n,r.push(o),r.push(n),r}function Qn(t,e){return t[0]*e[1]-t[1]*e[0]}function to(t,e){return t[0]*e[0]+t[1]*e[1]}function eo(t,e,r){const n=function(t,e,r,n,o){const i=[e[0]-t[0],e[1]-t[1]],a=[n[0]-r[0],n[1]-r[1]];function s(t,e,r){return[t[0]+e*r[0],t[1]+e*r[1]]}const u=[r[0]-t[0],r[1]-t[1]];let l=Qn(i,a),c=l*l;const f=to(i,i);if(c>0){const e=Qn(u,a)/l;if(e<0||e>1)return null;const n=Qn(u,i)/l;return n<0||n>1?null:0===e||1===e?o?null:[s(t,e,i)]:0===n||1===n?o?null:[s(r,n,a)]:[s(t,e,i)]}if(l=Qn(u,i),c=l*l,c>0)return null;const p=to(i,u)/f,h=p+to(i,a)/f,g=Math.min(p,h),d=Math.max(p,h);return g<=1&&d>=0?1===g?o?null:[s(t,g>0?g:0,i)]:0===d?o?null:[s(t,d<1?d:1,i)]:o&&0===g&&1===d?null:[s(t,g>0?g:0,i),s(t,d<1?d:1,i)]:null}(t.point,t.otherEvent.point,e.point,e.otherEvent.point),o=n?n.length:0;if(0===o)return 0;if(1===o&&(Kn(t.point,e.point)||Kn(t.otherEvent.point,e.otherEvent.point)))return 0;if(2===o&&t.isSubject===e.isSubject)return 0;if(1===o)return Kn(t.point,n[0])||Kn(t.otherEvent.point,n[0])||Hn(t,n[0],r),Kn(e.point,n[0])||Kn(e.otherEvent.point,n[0])||Hn(e,n[0],r),1;const i=[];let a=!1,s=!1;return Kn(t.point,e.point)?a=!0:1===Zn(t,e)?i.push(e,t):i.push(t,e),Kn(t.otherEvent.point,e.otherEvent.point)?s=!0:1===Zn(t.otherEvent,e.otherEvent)?i.push(e.otherEvent,t.otherEvent):i.push(t.otherEvent,e.otherEvent),a&&s||a?(e.type=1,t.type=e.inOut===t.inOut?2:3,a&&!s&&Hn(i[1].otherEvent,i[0].point,r),2):s?(Hn(i[0],i[1].point,r),3):i[0]!==i[3].otherEvent?(Hn(i[0],i[1].point,r),Hn(i[1],i[2].point,r),3):(Hn(i[0],i[1].point,r),Hn(i[3].otherEvent,i[2].point,r),3)}function ro(t,e){if(t===e)return 0;if(0!==Yn(t.point,t.otherEvent.point,e.point)||0!==Yn(t.point,t.otherEvent.point,e.otherEvent.point))return Kn(t.point,e.point)?t.isBelow(e.otherEvent.point)?-1:1:t.point[0]===e.point[0]?t.point[1]<e.point[1]?-1:1:1===Zn(t,e)?e.isAbove(t.point)?-1:1:t.isBelow(e.point)?-1:1;if(t.isSubject!==e.isSubject)return t.isSubject?-1:1;{let r=t.point,n=e.point;if(r[0]===n[0]&&r[1]===n[1])return r=t.otherEvent.point,n=e.otherEvent.point,r[0]===n[0]&&r[1]===n[1]?0:t.contourId>e.contourId?1:-1}return 1===Zn(t,e)?1:-1}function no(t,e,r,n){let o,i,a=t+1;const s=e.length;for(o=e[t].point,a<s&&(i=e[a].point);a<s&&i[0]===o[0]&&i[1]===o[1];){if(!r[a])return a;a++,i=e[a].point}for(a=t-1;r[a]&&a>=n;)a--;return a}function oo(t,e){let r,n;const o=function(t){let e,r,n,o;const i=[];for(r=0,n=t.length;r<n;r++)e=t[r],(e.left&&e.inResult||!e.left&&e.otherEvent.inResult)&&i.push(e);let a=!1;for(;!a;)for(a=!0,r=0,n=i.length;r<n;r++)r+1<n&&1===Zn(i[r],i[r+1])&&(o=i[r],i[r]=i[r+1],i[r+1]=o,a=!1);for(r=0,n=i.length;r<n;r++)e=i[r],e.pos=r;for(r=0,n=i.length;r<n;r++)e=i[r],e.left||(o=e.pos,e.pos=e.otherEvent.pos,e.otherEvent.pos=o);return i}(t),i={},a=[];let s;for(r=0,n=o.length;r<n;r++){if(i[r])continue;const t=[[]];o[r].isExteriorRing?2===e&&!o[r].isSubject&&a.length>1?a[a.length-1].push(t[0]):a.push(t):2!==e||o[r].isSubject||0!==a.length?0===a.length?a.push([[t]]):a[a.length-1].push(t[0]):a.push(t);const n=a.length-1;let u=r;const l=o[r].point;for(t[0].push(l);u>=r;)s=o[u],i[u]=!0,s.left?(s.resultInOut=!1,s.contourId=n):(s.otherEvent.resultInOut=!0,s.otherEvent.contourId=n),u=s.pos,i[u]=!0,t[0].push(o[u].point),u=no(u,o,i,r);u=-1===u?r:u,s=o[u],i[u]=i[s.pos]=!0,s.otherEvent.resultInOut=!0,s.otherEvent.contourId=n}return a}var io=so,ao=so;function so(t,e){if(!(this instanceof so))return new so(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||uo,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)}function uo(t,e){return t<e?-1:t>e?1:0}so.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,r=this.compare,n=e[t];t>0;){var o=t-1>>1,i=e[o];if(r(n,i)>=0)break;e[t]=i,t=o}e[t]=n},_down:function(t){for(var e=this.data,r=this.compare,n=this.length>>1,o=e[t];t<n;){var i=1+(t<<1),a=i+1,s=e[i];if(a<this.length&&r(e[a],s)<0&&(i=a,s=e[a]),r(s,o)>=0)break;e[t]=s,t=i}e[t]=o}},io.default=ao;const lo=Math.max,co=Math.min;let fo=0;function po(t,e,r,n,o,i){let a,s,u,l,c,f;for(a=0,s=t.length-1;a<s;a++){if(u=t[a],l=t[a+1],c=new Xn(u,!1,void 0,e),f=new Xn(l,!1,c,e),c.otherEvent=f,u[0]===l[0]&&u[1]===l[1])continue;c.contourId=f.contourId=r,i||(c.isExteriorRing=!1,f.isExteriorRing=!1),Zn(c,f)>0?f.left=!0:c.left=!0;const s=u[0],p=u[1];o[0]=co(o[0],s),o[1]=co(o[1],p),o[2]=lo(o[2],s),o[3]=lo(o[3],p),n.push(c),n.push(f)}}const ho=[];function go(t,e,r){"number"==typeof t[0][0][0]&&(t=[t]),"number"==typeof e[0][0][0]&&(e=[e]);let n=function(t,e,r){let n=null;return t.length*e.length==0&&(0===r?n=ho:2===r?n=t:1!==r&&3!==r||(n=0===t.length?e:t)),n}(t,e,r);if(n)return n===ho?null:n;const o=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],a=function(t,e,r,n,o){const i=new io(null,Zn);let a,s,u,l,c,f;for(u=0,l=t.length;u<l;u++)for(a=t[u],c=0,f=a.length;c<f;c++)s=0===c,s&&fo++,po(a[c],!0,fo,i,r,s);for(u=0,l=e.length;u<l;u++)for(a=e[u],c=0,f=a.length;c<f;c++)s=0===c,2===o&&(s=!1),s&&fo++,po(a[c],!1,fo,i,n,s);return i}(t,e,o,i,r);if(n=function(t,e,r,n,o){let i=null;return(r[0]>n[2]||n[0]>r[2]||r[1]>n[3]||n[1]>r[3])&&(0===o?i=ho:2===o?i=t:1!==o&&3!==o||(i=t.concat(e))),i}(t,e,o,i,r),n)return n===ho?null:n;return oo(function(t,e,r,n,o,i){const a=new Gn(ro),s=[],u=Math.min(n[2],o[2]);let l,c,f;for(;0!==t.length;){let e=t.pop();if(s.push(e),0===i&&e.point[0]>u||2===i&&e.point[0]>n[2])break;if(e.left){c=l=a.insert(e),f=a.minNode(),l=l!==f?a.prev(l):null,c=a.next(c);const r=l?l.key:null;let n;if($n(e,r,i),c&&2===eo(e,c.key,t)&&($n(e,r,i),$n(e,c.key,i)),l&&2===eo(l.key,e,t)){let t=l;t=t!==f?a.prev(t):null,n=t?t.key:null,$n(r,n,i),$n(e,r,i)}}else e=e.otherEvent,c=l=a.find(e),l&&c&&(l=l!==f?a.prev(l):null,c=a.next(c),a.remove(e),c&&l&&eo(l.key,c.key,t))}return s}(a,0,0,o,i,r),r)}const yo=(t,e)=>{for(var r=t[0],n=t[1],o=!1,i=0,a=e.length-1;i<e.length;a=i++){var s=e[i][0],u=e[i][1],l=e[a][0],c=e[a][1];u>n!=c>n&&r<(l-s)*(n-u)/(c-u)+s&&(o=!o)}return o},bo=t=>{if("Point"!==t.geometry.type){switch(t.properties.way_geometry=Rn(t.geometry),t.geometry.type){case"Polygon":t.properties.mesure=Lt(t.geometry);break;case"LineString":"function"==typeof length&&(t.properties.mesure=length(t))}t.geometry=It(t.geometry).geometry}},mo=t=>{if("no"===t.area)return!1;const e=Object.keys(t);return!(!e.includes("building")||"no"===t.building)||(!(!e.includes("landuse")||"no"===t.landuse)||(!(!e.includes("amenity")||"no"===t.amenity)||(!(!e.includes("leisure")||"no"===t.leisure)||(!(!e.includes("area")||"no"===t.area)||(!(!e.includes("place")||"no"===t.place)||(!(!e.includes("shop")||"no"===t.shop)||(!(!e.includes("boundary")||"no"===t.boundary)||(!(!e.includes("tourism")||"no"===t.tourism)||(!(!e.includes("historic")||"no"===t.historic)||(!(!e.includes("public_transport")||"no"===t.public_transport)||(!(!e.includes("office")||"no"===t.office)||(!(!e.includes("building:part")||"no"===t["building:part"])||(!(!e.includes("military")||"no"===t.military)||(!(!e.includes("ruins")||"no"===t.ruins)||(!(!e.includes("craft")||"no"===t.craft)||(!(!e.includes("golf")||"no"===t.golf)||(!(!e.includes("indoor")||"no"===t.indoor)||(!(!e.includes("highway")||!["services","rest_area","escape","elevator"].includes(t.highway))||(!(!e.includes("waterway")||!["riverbank","dock","boatyard","dam"].includes(t.waterway))||(!(!e.includes("barrier")||!["city_wall","ditch","hedge","retaining_wall","wall","spikes"].includes(t.barrier))||(!(!e.includes("railway")||!["station","turntable","roundhouse","platform"].includes(t.railway))||(!(!e.includes("power")||!["plant","substation","generator","transformer"].includes(t.power))||(!(!e.includes("natural")||["coastline","cliff","ridge","arete","tree_row"].includes(t.natural))||(!(!e.includes("man_made")||["cutline","embankment","pipeline"].includes(t.man_made))||!(!e.includes("aeroway")||["taxiway"].includes(t.aeroway))))))))))))))))))))))))))},vo=(t,e)=>{if(!e)return!0;if(!t)return!1;const r=Object.keys(t);for(let t of r)if(e.includes(t))return!0;return!1},wo=(t,e)=>{const r=t.properties.tags;let n={k:"",v:""};for(let t in r)if(e.includes(t))return n={k:t,v:r[t]},n;return null};function jo(t,e){const r=t.properties.tags;let n={conf:void 0,matchProps:0};for(let t of e){const e=Object.keys(t.tags)[0];let o=0;for(let n in t.tags)r[n]&&r[n]===t.tags[n]&&r[e]?o++:o=0;o>n.matchProps&&(n={conf:t,matchProps:o})}if(n.conf)return n.conf;{const e=t.properties.primaryTag.k?"k":"key",r=t.properties.primaryTag.k?"v":"value",n="".concat(t.properties.primaryTag[e],"/").concat(t.properties.primaryTag[r]),o={key:t.properties.primaryTag[e],icon:"wiki-question",markerColor:"#000000",lbl:{en:"".concat(t.properties.primaryTag[e]," = ").concat(t.properties.primaryTag[r])},presets:[],geometry:[],tags:{},id:n,unknowTags:!0};return o.tags[t.properties.primaryTag[e]]=t.properties.primaryTag[r],o}}function Ao(t){t.properties.tags.name?t.properties._name=t.properties.tags.name:t.properties.tags.ref&&(t.properties._name=t.properties.tags.ref),t.properties.meta.timestamp&&(t.properties.time=new Date(t.properties.meta.timestamp).getTime()),t.properties.tags.fixme&&(t.properties.fixme=!0)}function Eo(t,e){let r,n=jo(t,e);return r="node"===t.properties.type?"circle":"LineString"===t.properties.way_geometry.type||"MultiLineString"===t.properties.way_geometry.type?"penta":"Polygon"===t.properties.way_geometry.type||"MultiPolygon"===t.properties.way_geometry.type?"square":"star",t.properties.icon=n.icon?n.icon:"",t.properties.marker="".concat(r,"-").concat(n.markerColor,"-").concat(t.properties.icon),t.properties.hexColor=n.markerColor,t.properties.configId=n.id,n.unknowTags&&(t.properties.unknowTags=!0),n.deprecated?t.properties.deprecated=n.deprecated:t.properties.deprecated&&delete t.properties.deprecated,Ao(t),t}const xo=(t,e)=>{if(!e)return t;let r=[];for(let t=0;t<e.features.length;t++)r.push(e.features[t].id);for(let e=t.features.length-1;e>=0;e--)r.includes(t.features[e].id)&&t.features.splice(e,1);return Rn(t)},_o=(t,e)=>{if(e&&0!==e.length){return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"MultiPolygon",coordinates:go(e.geometry.coordinates,t.geometry.coordinates,1)}}]}}return{type:"FeatureCollection",features:[t]}};function Oo(t){return t.replace(/&amp;/g,"&").replace(/&apos;/g,"'").replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">")}exports.addAttributesToFeature=Ao,exports.convert=(t,e)=>{let r=null;e&&e.primaryKeys&&(r=e.primaryKeys);const n=ot.parse(t,{attributeNamePrefix:"",attrNodeName:!1,textNodeName:"#text",ignoreAttributes:!1,ignoreNameSpace:!1,allowBooleanAttributes:!0,parseNodeValue:!1,parseAttributeValue:!1,trimValues:!1,cdataTagName:!1,cdataPositionChar:"\\c",attrValueProcessor:t=>Oo(t),tagValueProcessor:t=>Oo(t)}).osm,o={minlat:Number(n.bounds.minlat),minlon:Number(n.bounds.minlon),maxlat:Number(n.bounds.maxlat),maxlon:Number(n.bounds.maxlon)},i=[o.minlon,o.minlat,o.maxlon,o.maxlat],a=t=>{Array.isArray(t)||(t=[t]);const e={};for(let r=0;r<t.length;r++)e[t[r].k]=t[r].v;return e},s=(t,e)=>{const r=t[0]==t[t.length-1]?"Polygon":"LineString";let n=[];for(let r=0;r<t.length;r++){const o="node/".concat(t[r]);e[o]&&n.push(e[o].geometry.coordinates)}return"LineString"==r?{type:"LineString",coordinates:n}:"Polygon"==r?{type:"Polygon",coordinates:[n]}:void 0},u=(t,e,r)=>{const n=Rn(t);let o=Array.isArray(n.member)?n.member:[n.member];n.tainted=!1;for(let t=0;t<o.length;t++){let r=o[t];const i="way/".concat(r.ref);if(e[i]){let t,n=e[i].geometry;"LineString"===n.type?(r.typeGeom="LineString",t=Rn(n.coordinates)):"Polygon"===n.type&&(r.typeGeom="Polygon",t=Rn(n.coordinates[0])),r.ring=t}else r.ring=null,n.tainted=!0}if(n.tainted)return null;Array.isArray(o)||(o=[o]);const i=o.filter((t=>"outer"===t.role&&"Polygon"===t.typeGeom&&t.ring)),a=o.filter((t=>"inner"===t.role&&"Polygon"===t.typeGeom&&t.ring)),s=o.filter((t=>"outer"===t.role&&"LineString"===t.typeGeom&&t.ring)),u=o.filter((t=>"inner"===t.role&&"LineString"===t.typeGeom&&t.ring));if(0===i.length&&0===s.length)return null;if(s.length>0){const t=l(s.map((t=>t.ring)));for(let e of t)i.push({type:"way",ref:"",role:"outer",typeGeom:"Polygon",ring:e})}if(u.length>0){const t=l(u.map((t=>t.ring)));for(let e of t)a.push({type:"way",ref:"",role:"inner",typeGeom:"Polygon",ring:e})}if(1==i.length){const t=[i[0].ring];for(let e of a)t.push(e.ring);return{type:"Polygon",coordinates:t}}{const t=i.map((t=>[t.ring]));for(let e of a)for(let r=0;r<t.length;r++){let n=t[r][0];const o=e.ring[0];yo(o,n)&&t[r].push(e.ring)}return{type:"MultiPolygon",coordinates:t}}},l=t=>{let e=[],r=t[0].slice();t.splice(0,1);let n=r[0].toString(),o=r[r.length-1].toString(),i=0;for(;0!=t.length&&i<t.length;)t[i][0].toString()==o?(t[i].splice(0,1),r=[...r,...t[i]],t.splice(i,1),n=r[0].toString(),o=r[r.length-1].toString(),i=0):t[i][t[i].length-1].toString()==n?(t[i].splice(t[i].length-1,1),r=[...t[i],...r],t.splice(i,1),n=r[0].toString(),o=r[r.length-1].toString(),i=0):t[i][0].toString()==n?(t[i].splice(0,1),r=[...t[i].reverse(),...r],t.splice(i,1),n=r[0].toString(),o=r[r.length-1].toString(),i=0):t[i][t[i].length-1].toString()==o?(t[i].splice(t[i].length-1,1),r=[...r,...t[i].reverse()],t.splice(i,1),n=r[0].toString(),o=r[r.length-1].toString(),i=0):i++,n==o&&(e.push(r),t.length>0&&(r=t[0].slice(),t.splice(0,1),n=r[0].toString(),o=r[r.length-1].toString(),i=0));return e},c={};Array.isArray(n.node)||(n.node=n.node?[n.node]:[]);for(let t of n.node){const e="node/".concat(t.id),r={type:"Feature",id:"node/".concat(t.id),properties:{type:"node",id:t.id,meta:{timestamp:t.timestamp,version:t.version,changeset:t.changeset,user:t.user,uid:t.uid}},geometry:{type:"Point",coordinates:[Number(t.lon),Number(t.lat)]}};t.tag&&(r.properties.tags=a(t.tag)),c[e]=r}Array.isArray(n.way)||(n.way=n.way?[n.way]:[]);const f={};for(let t of n.way){const e="way/".concat(t.id),r={type:"Feature",id:"way/".concat(t.id),properties:{type:"way",id:t.id,meta:{timestamp:t.timestamp,version:t.version,changeset:t.changeset,user:t.user,uid:t.uid}}};if(t.tag&&(r.properties.tags=a(t.tag)),t.nd){const e=[];for(let r of t.nd){const n=r.ref;e.push(n);let o=c["node/".concat(n)];o&&(o.properties.usedByWays||(o.properties.usedByWays=[]),o.properties.usedByWays.push("way/".concat(t.id)))}r.ndRefs=e,r.geometry=s(e,c)}f[e]=r}const p={};Array.isArray(n.relation)||(n.relation=n.relation?[n.relation]:[]);for(let t of n.relation){const e="".concat(t.id),r={type:"Feature",id:"".concat(t.id),properties:{type:"relation",id:t.id,meta:{timestamp:t.timestamp,version:t.version,changeset:t.changeset,user:t.user,uid:t.uid}},member:t.member,tainted:!1};t.tag&&(r.properties.tags=a(t.tag)),Array.isArray(t.member)||(t.member=[t.member]);for(let e of t.member){const t="".concat(e.type,"/").concat(e.ref);let n="node"==e.type?c:f;n[t]?(n[t].properties.relations||(n[t].properties.relations=[]),n[t].properties.relations.push({rel:r.id,reltags:r.properties.tags,role:e.role})):r.tainted=!0}p[e]=r}for(let t in p){const e=p[t];if("multipolygon"===e.properties.tags.type){const t=u(e,f);t&&(e.geometry=t)}}const h={type:"FeatureCollection",features:((t,n,o,i,a)=>{const s=[];for(let r in t)if(t[r].properties.tags,t[r].geometry&&t[r].properties.tags)if(Ao(t[r]),e&&i){let n=wo(t[r],a);n&&(t[r].properties.primaryTag=n,Eo(t[r],e.tagConfig),s.push(t[r]))}else s.push(t[r]);for(let t in n)if(n[t].properties.tags,n[t].geometry&&n[t].properties.tags)if(Ao(n[t]),"Polygon"!=n[t].geometry.type&&"MultiPolygon"!=n[t].geometry.type||mo(n[t].properties.tags)||(n[t].geometry.coordinates=n[t].geometry.coordinates[0],n[t].geometry.type="Polygon"==n[t].geometry.type?"LineString":"MultiLineString"),bo(n[t]),e&&e.tagConfig){let r=wo(n[t],a);r&&(n[t].properties.primaryTag=r,Eo(n[t],e.tagConfig),s.push(n[t]))}else s.push(n[t]);for(let t in o){const n=o[t].properties.tags;if(o[t].geometry&&o[t].properties.tags&&vo(n,r))if(Ao(o[t]),"Polygon"!=o[t].geometry.type&&"MultiPolygon"!=o[t].geometry.type||mo(o[t].properties.tags)||(o[t].geometry.coordinates=o[t].geometry.coordinates[0],o[t].geometry.type="Polygon"==o[t].geometry.type?"LineString":"MultiLineString"),bo(o[t]),e&&e.tagConfig){let r=wo(o[t],a);r&&(o[t].properties.primaryTag=r,Eo(o[t],e.tagConfig),s.push(o[t]))}else s.push(o[t])}return s})(c,f,p,e.tagConfig,e.primaryKeys)};if(e&&e.oldGeojson&&e.geojsonChanged){const t=Number.isInteger(e.limitFeatures)?e.limitFeatures:9999,r=Ut(i);if(e.oldGeojson.features.length>t){return{geojson:xo(h,e.geojsonChanged),geojsonBbox:_o(r,null)}}return{geojson:((t,e,r,n)=>{let o=t.features,i=e.features;if(!o||0==o.length)return e;let a=[];for(let t=0;t<o.length;t++)zt(o[t],r)&&a.push(o[t].id);for(let t=0;t<i.length;t++){let e=i[t].id;for(let r=0;r<o.length;r++){if(e==o[r].id){o[r]=i[t],a.splice(a.indexOf(e),1);break}r==o.length-1&&o.push(i[t])}}for(let t=0;t<a.length;t++){let e=a[t];for(let t=0;t<o.length;t++)if(o[t].id==e){o.splice(t,1);break}}return xo(t,n)})(e.oldGeojson,h,r,e.geojsonChanged),geojsonBbox:_o(r,e.oldBboxFeature)}}return{geojson:h,geojsonBbox:null}},exports.getConfigTag=jo,exports.setIconStyle=Eo;
