var osmToOsmgo=function(e){"use strict";function t(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function r(e){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?t(Object(o),!0).forEach((function(t){n(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||i(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){if(e){if("string"==typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=i(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){l=!0,s=e},f:function(){try{a||null==r.return||r.return()}finally{if(l)throw s}}}}var l=6371008.8,u={centimeters:637100880,centimetres:637100880,degrees:57.22891354143274,feet:20902260.511392,inches:39.37*l,kilometers:6371.0088,kilometres:6371.0088,meters:l,metres:l,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:l/1852,radians:1,yards:6967335.223679999};function p(e,t,r){void 0===r&&(r={});var n={type:"Feature"};return(0===r.id||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=t||{},n.geometry=e,n}function c(e,t,r){if(void 0===r&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!y(e[0])||!y(e[1]))throw new Error("coordinates must contain numbers");return p({type:"Point",coordinates:e},t,r)}function f(e,t,r){if(void 0===r&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");return p({type:"LineString",coordinates:e},t,r)}function h(e,t){void 0===t&&(t={});var r={type:"FeatureCollection"};return t.id&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.features=e,r}function g(e){return e%360*Math.PI/180}function y(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function d(e,t,r){if(null!==e)for(var n,o,i,s,a,l,u,p,c=0,f=0,h=e.type,g="FeatureCollection"===h,y="Feature"===h,m=g?e.features.length:1,v=0;v<m;v++){a=(p=!!(u=g?e.features[v].geometry:y?e.geometry:e)&&"GeometryCollection"===u.type)?u.geometries.length:1;for(var b=0;b<a;b++){var w=0,P=0;if(null!==(s=p?u.geometries[b]:u)){l=s.coordinates;var k=s.type;switch(c=!r||"Polygon"!==k&&"MultiPolygon"!==k?0:1,k){case null:break;case"Point":if(!1===t(l,f,v,w,P))return!1;f++,w++;break;case"LineString":case"MultiPoint":for(n=0;n<l.length;n++){if(!1===t(l[n],f,v,w,P))return!1;f++,"MultiPoint"===k&&w++}"LineString"===k&&w++;break;case"Polygon":case"MultiLineString":for(n=0;n<l.length;n++){for(o=0;o<l[n].length-c;o++){if(!1===t(l[n][o],f,v,w,P))return!1;f++}"MultiLineString"===k&&w++,"Polygon"===k&&P++}"Polygon"===k&&w++;break;case"MultiPolygon":for(n=0;n<l.length;n++){for(P=0,o=0;o<l[n].length;o++){for(i=0;i<l[n][o].length-c;i++){if(!1===t(l[n][o][i],f,v,w,P))return!1;f++}P++}w++}break;case"GeometryCollection":for(n=0;n<s.geometries.length;n++)if(!1===d(s.geometries[n],t,r))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function m(e,t){if("Feature"===e.type)t(e,0);else if("FeatureCollection"===e.type)for(var r=0;r<e.features.length&&!1!==t(e.features[r],r);r++);}function v(e,t){var r,n,o,i,s,a,l,u,p,c,f=0,h="FeatureCollection"===e.type,g="Feature"===e.type,y=h?e.features.length:1;for(r=0;r<y;r++){for(a=h?e.features[r].geometry:g?e.geometry:e,u=h?e.features[r].properties:g?e.properties:{},p=h?e.features[r].bbox:g?e.bbox:void 0,c=h?e.features[r].id:g?e.id:void 0,s=(l=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,o=0;o<s;o++)if(null!==(i=l?a.geometries[o]:a))switch(i.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(i,f,u,p,c))return!1;break;case"GeometryCollection":for(n=0;n<i.geometries.length;n++)if(!1===t(i.geometries[n],f,u,p,c))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,f,u,p,c))return!1;f++}}function b(e,t){!function(e,t){v(e,(function(e,r,n,o,i){var s,a=null===e?null:e.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return!1!==t(p(e,n,{bbox:o,id:i}),r,0)&&void 0}switch(a){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var l=0;l<e.coordinates.length;l++){var u=e.coordinates[l];if(!1===t(p({type:s,coordinates:u},n),r,l))return!1}}))}(e,(function(e,r,n){var o=0;if(e.geometry){var i=e.geometry.type;if("Point"!==i&&"MultiPoint"!==i){var s,a=0,l=0,u=0;return!1!==d(e,(function(i,p,c,h,g){if(void 0===s||r>a||h>l||g>u)return s=i,a=r,l=h,u=g,void(o=0);var y=f([s,i],e.properties);if(!1===t(y,r,n,g,o))return!1;o++,s=i}))&&void 0}}}))}function w(e){var t=[];return"FeatureCollection"===e.type?m(e,(function(e){d(e,(function(r){t.push(c(r,e.properties))}))})):d(e,(function(r){t.push(c(r,e.properties))})),h(t)}function P(e){var t=[1/0,1/0,-1/0,-1/0];return d(e,(function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])})),t}function k(e){if(!e)throw new Error("geojson is required");switch(e.type){case"Feature":return E(e);case"FeatureCollection":return function(e){var t={type:"FeatureCollection"};return Object.keys(e).forEach((function(r){switch(r){case"type":case"features":return;default:t[r]=e[r]}})),t.features=e.features.map((function(e){return E(e)})),t}(e);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return O(e);default:throw new Error("unknown GeoJSON type")}}function E(e){var t={type:"Feature"};return Object.keys(e).forEach((function(r){switch(r){case"type":case"properties":case"geometry":return;default:t[r]=e[r]}})),t.properties=S(e.properties),t.geometry=O(e.geometry),t}function S(e){var t={};return e?(Object.keys(e).forEach((function(r){var n=e[r];"object"==typeof n?null===n?t[r]=null:Array.isArray(n)?t[r]=n.map((function(e){return e})):t[r]=S(n):t[r]=n})),t):t}function O(e){var t={type:e.type};return e.bbox&&(t.bbox=e.bbox),"GeometryCollection"===e.type?(t.geometries=e.geometries.map((function(e){return O(e)})),t):(t.coordinates=_(e.coordinates),t)}function _(e){var t=e;return"object"!=typeof t[0]?t.slice():t.map((function(e){return _(e)}))}function M(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return e.geometry.coordinates;if("Point"===e.type)return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function j(e,t,r){void 0===r&&(r={});var n=M(e),o=M(t),i=g(o[1]-n[1]),s=g(o[0]-n[0]),a=g(n[1]),l=g(o[1]),p=Math.pow(Math.sin(i/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return function(e,t){void 0===t&&(t="kilometers");var r=u[t];if(!r)throw new Error(t+" units is invalid");return e*r}(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)),r.units)}function x(e,t,r){if(void 0===r&&(r={}),!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");var n,o=M(e),i="Feature"===(n=t).type?n.geometry:n,s=i.type,a=t.bbox,l=i.coordinates;if(a&&!1===function(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}(o,a))return!1;"Polygon"===s&&(l=[l]);for(var u=!1,p=0;p<l.length&&!u;p++)if(I(o,l[p][0],r.ignoreBoundary)){for(var c=!1,f=1;f<l[p].length&&!c;)I(o,l[p][f],!r.ignoreBoundary)&&(c=!0),f++;c||(u=!0)}return u}function I(e,t,r){var n=!1;t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]&&(t=t.slice(0,t.length-1));for(var o=0,i=t.length-1;o<t.length;i=o++){var s=t[o][0],a=t[o][1],l=t[i][0],u=t[i][1];if(e[1]*(s-l)+a*(l-e[0])+u*(e[0]-s)==0&&(s-e[0])*(l-e[0])<=0&&(a-e[1])*(u-e[1])<=0)return!r;a>e[1]!=u>e[1]&&e[0]<(l-s)*(e[1]-a)/(u-a)+s&&(n=!n)}return n}function F(e){for(var t=function(e){if("FeatureCollection"!==e.type)return"Feature"!==e.type?h([p(e)]):h([e]);return e}(e),r=function(e,t){void 0===t&&(t={});var r=P(e);return c([(r[0]+r[2])/2,(r[1]+r[3])/2],t.properties,t)}(t),n=!1,o=0;!n&&o<t.features.length;){var i,s=t.features[o].geometry,a=!1;if("Point"===s.type)r.geometry.coordinates[0]===s.coordinates[0]&&r.geometry.coordinates[1]===s.coordinates[1]&&(n=!0);else if("MultiPoint"===s.type){var l=!1;for(i=0;!l&&i<s.coordinates.length;)r.geometry.coordinates[0]===s.coordinates[i][0]&&r.geometry.coordinates[1]===s.coordinates[i][1]&&(n=!0,l=!0),i++}else if("LineString"===s.type)for(i=0;!a&&i<s.coordinates.length-1;)L(r.geometry.coordinates[0],r.geometry.coordinates[1],s.coordinates[i][0],s.coordinates[i][1],s.coordinates[i+1][0],s.coordinates[i+1][1])&&(a=!0,n=!0),i++;else if("MultiLineString"===s.type)for(var u=0;u<s.coordinates.length;){a=!1,i=0;for(var f=s.coordinates[u];!a&&i<f.length-1;)L(r.geometry.coordinates[0],r.geometry.coordinates[1],f[i][0],f[i][1],f[i+1][0],f[i+1][1])&&(a=!0,n=!0),i++;u++}else"Polygon"!==s.type&&"MultiPolygon"!==s.type||x(r,s)&&(n=!0);o++}if(n)return r;var g=h([]);for(o=0;o<t.features.length;o++)g.features=g.features.concat(w(t.features[o]).features);return c(function(e,t){if(!e)throw new Error("targetPoint is required");if(!t)throw new Error("points is required");var r,n=1/0,o=0;return m(t,(function(t,r){var i=j(e,t);i<n&&(o=r,n=i)})),(r=k(t.features[o])).properties.featureIndex=o,r.properties.distanceToPoint=n,r}(r,g).geometry.coordinates)}function L(e,t,r,n,o,i){return Math.sqrt((o-r)*(o-r)+(i-n)*(i-n))===Math.sqrt((e-r)*(e-r)+(t-n)*(t-n))+Math.sqrt((o-e)*(o-e)+(i-t)*(i-t))}P.default=P;var A=6378137;function T(e){return function(e,t,r){var n=r;return v(e,(function(e,o,i,s,a){n=0===o&&void 0===r?e:t(n,e,o,i,s,a)})),n}(e,(function(e,t){return e+function(e){var t,r=0;switch(e.type){case"Polygon":return C(e.coordinates);case"MultiPolygon":for(t=0;t<e.coordinates.length;t++)r+=C(e.coordinates[t]);return r;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}(t)}),0)}function C(e){var t=0;if(e&&e.length>0){t+=Math.abs(N(e[0]));for(var r=1;r<e.length;r++)t-=Math.abs(N(e[r]))}return t}function N(e){var t,r,n,o,i,s,a=0,l=e.length;if(l>2){for(s=0;s<l;s++)s===l-2?(n=l-2,o=l-1,i=0):s===l-1?(n=l-1,o=0,i=1):(n=s,o=s+1,i=s+2),t=e[n],r=e[o],a+=(R(e[i][0])-R(t[0]))*Math.sin(R(r[1]));a=a*A*A/2}return a}function R(e){return e*Math.PI/180}function G(e,t){return void 0===t&&(t={}),function(e,t,r){var n=r,o=!1;return b(e,(function(e,i,s,a,l){n=!1===o&&void 0===r?e:t(n,e,i,s,a,l),o=!0})),n}(e,(function(e,r){var n=r.geometry.coordinates;return e+j(n[0],n[1],t)}),0)}function B(e,t){void 0===t&&(t={});var r=Number(e[0]),n=Number(e[1]),o=Number(e[2]),i=Number(e[3]);if(6===e.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var s=[r,n];return function(e,t,r){void 0===r&&(r={});for(var n=0,o=e;n<o.length;n++){var i=o[n];if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<i[i.length-1].length;s++)if(i[i.length-1][s]!==i[0][s])throw new Error("First and last Position are not equivalent.")}return p({type:"Polygon",coordinates:e},t,r)}([[s,[o,n],[o,i],[r,i],s]],t.properties,{bbox:e,id:t.id})}function q(e,t){return e>t?1:e<t?-1:0}class z{constructor(e=q,t=!1){this._compare=e,this._root=null,this._size=0,this._noDuplicates=!!t}rotateLeft(e){var t=e.right;t&&(e.right=t.left,t.left&&(t.left.parent=e),t.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=t:e.parent.right=t:this._root=t,t&&(t.left=e),e.parent=t}rotateRight(e){var t=e.left;t&&(e.left=t.right,t.right&&(t.right.parent=e),t.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=t:e.parent.right=t:this._root=t,t&&(t.right=e),e.parent=t}_splay(e){for(;e.parent;){var t=e.parent;t.parent?t.left===e&&t.parent.left===t?(this.rotateRight(t.parent),this.rotateRight(t)):t.right===e&&t.parent.right===t?(this.rotateLeft(t.parent),this.rotateLeft(t)):t.left===e&&t.parent.right===t?(this.rotateRight(t),this.rotateLeft(t)):(this.rotateLeft(t),this.rotateRight(t)):t.left===e?this.rotateRight(t):this.rotateLeft(t)}}splay(e){for(var t,r,n,o,i;e.parent;)(r=(t=e.parent).parent)&&r.parent?((n=r.parent).left===r?n.left=e:n.right=e,e.parent=n):(e.parent=null,this._root=e),o=e.left,i=e.right,e===t.left?(r&&(r.left===t?(t.right?(r.left=t.right,r.left.parent=r):r.left=null,t.right=r,r.parent=t):(o?(r.right=o,o.parent=r):r.right=null,e.left=r,r.parent=e)),i?(t.left=i,i.parent=t):t.left=null,e.right=t,t.parent=e):(r&&(r.right===t?(t.left?(r.right=t.left,r.right.parent=r):r.right=null,t.left=r,r.parent=t):(i?(r.left=i,i.parent=r):r.left=null,e.right=r,r.parent=e)),o?(t.right=o,o.parent=t):t.right=null,e.left=t,t.parent=e)}replace(e,t){e.parent?e===e.parent.left?e.parent.left=t:e.parent.right=t:this._root=t,t&&(t.parent=e.parent)}minNode(e=this._root){if(e)for(;e.left;)e=e.left;return e}maxNode(e=this._root){if(e)for(;e.right;)e=e.right;return e}insert(e,t){var r=this._root,n=null,o=this._compare;if(this._noDuplicates)for(;r;){if(n=r,0===o(r.key,e))return;r=o(r.key,e)<0?r.right:r.left}else for(;r;)n=r,r=o(r.key,e)<0?r.right:r.left;return r={key:e,data:t,left:null,right:null,parent:n},n?o(n.key,r.key)<0?n.right=r:n.left=r:this._root=r,this.splay(r),this._size++,r}find(e){for(var t=this._root,r=this._compare;t;){var n=r(t.key,e);if(n<0)t=t.right;else{if(!(n>0))return t;t=t.left}}return null}contains(e){for(var t=this._root,r=this._compare;t;){var n=r(e,t.key);if(0===n)return!0;t=n<0?t.left:t.right}return!1}remove(e){var t=this.find(e);if(!t)return!1;if(this.splay(t),t.left)if(t.right){var r=this.minNode(t.right);r.parent!==t&&(this.replace(r,r.right),r.right=t.right,r.right.parent=r),this.replace(t,r),r.left=t.left,r.left.parent=r}else this.replace(t,t.left);else this.replace(t,t.right);return this._size--,!0}removeNode(e){if(!e)return!1;if(this.splay(e),e.left)if(e.right){var t=this.minNode(e.right);t.parent!==e&&(this.replace(t,t.right),t.right=e.right,t.right.parent=t),this.replace(e,t),t.left=e.left,t.left.parent=t}else this.replace(e,e.left);else this.replace(e,e.right);return this._size--,!0}erase(e){var t=this.find(e);if(t){this.splay(t);var r=t.left,n=t.right,o=null;r&&(r.parent=null,o=this.maxNode(r),this.splay(o),this._root=o),n&&(r?o.right=n:this._root=n,n.parent=o),this._size--}}pop(){var e=this._root,t=null;if(e){for(;e.left;)e=e.left;t={key:e.key,data:e.data},this.remove(e.key)}return t}next(e){var t=e;if(t)if(t.right)for(t=t.right;t&&t.left;)t=t.left;else for(t=e.parent;t&&t.right===e;)e=t,t=t.parent;return t}prev(e){var t=e;if(t)if(t.left)for(t=t.left;t&&t.right;)t=t.right;else for(t=e.parent;t&&t.left===e;)e=t,t=t.parent;return t}forEach(e){for(var t=this._root,r=[],n=!1,o=0;!n;)t?(r.push(t),t=t.left):r.length>0?(e(t=r.pop(),o++),t=t.right):n=!0;return this}range(e,t,r,n){const o=[],i=this._compare;let s,a=this._root;for(;0!==o.length||a;)if(a)o.push(a),a=a.left;else{if(a=o.pop(),s=i(a.key,t),s>0)break;if(i(a.key,e)>=0&&r.call(n,a))return this;a=a.right}return this}keys(){for(var e=this._root,t=[],r=[],n=!1;!n;)e?(t.push(e),e=e.left):t.length>0?(e=t.pop(),r.push(e.key),e=e.right):n=!0;return r}values(){for(var e=this._root,t=[],r=[],n=!1;!n;)e?(t.push(e),e=e.left):t.length>0?(e=t.pop(),r.push(e.data),e=e.right):n=!0;return r}at(e){for(var t=this._root,r=[],n=!1,o=0;!n;)if(t)r.push(t),t=t.left;else if(r.length>0){if(t=r.pop(),o===e)return t;o++,t=t.right}else n=!0;return null}load(e=[],t=[],r=!1){if(0!==this._size)throw new Error("bulk-load: tree is not empty");const n=e.length;return r&&J(e,t,0,n-1,this._compare),this._root=D(null,e,t,0,n),this._size=n,this}min(){var e=this.minNode(this._root);return e?e.key:null}max(){var e=this.maxNode(this._root);return e?e.key:null}isEmpty(){return null===this._root}get size(){return this._size}static createTree(e,t,r,n,o){return new z(r,o).load(e,t,n)}}function D(e,t,r,n,o){const i=o-n;if(i>0){const s=n+Math.floor(i/2),a={key:t[s],data:r[s],parent:e};return a.left=D(a,t,r,n,s),a.right=D(a,t,r,s+1,o),a}return null}function J(e,t,r,n,o){if(r>=n)return;const i=e[r+n>>1];let s=r-1,a=n+1;for(;;){do{s++}while(o(e[s],i)<0);do{a--}while(o(e[a],i)>0);if(s>=a)break;let r=e[s];e[s]=e[a],e[a]=r,r=t[s],t[s]=t[a],t[a]=r}J(e,t,r,a,o),J(e,t,a+1,n,o)}function K(e,t,r){null===t?(e.inOut=!1,e.otherInOut=!0):(e.isSubject===t.isSubject?(e.inOut=!t.inOut,e.otherInOut=t.otherInOut):(e.inOut=!t.otherInOut,e.otherInOut=t.isVertical()?!t.inOut:t.inOut),t&&(e.prevInResult=!U(t,r)||t.isVertical()?t.prevInResult:t));let n=U(e,r);e.resultTransition=n?function(e,t){let r,n=!e.inOut,o=!e.otherInOut;switch(t){case 0:r=n&&o;break;case 1:r=n||o;break;case 3:r=n^o;break;case 2:r=e.isSubject?n&&!o:o&&!n}return r?1:-1}(e,r):0}function U(e,t){switch(e.type){case 0:switch(t){case 0:return!e.otherInOut;case 1:return e.otherInOut;case 2:return e.isSubject&&e.otherInOut||!e.isSubject&&!e.otherInOut;case 3:return!0}break;case 2:return 0===t||1===t;case 3:return 2===t;case 1:return!1}return!1}class V{constructor(e,t,r,n,o){this.left=t,this.point=e,this.otherEvent=r,this.isSubject=n,this.type=o||0,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0}isBelow(e){const t=this.point,r=this.otherEvent.point;return this.left?(t[0]-e[0])*(r[1]-e[1])-(r[0]-e[0])*(t[1]-e[1])>0:(r[0]-e[0])*(t[1]-e[1])-(t[0]-e[0])*(r[1]-e[1])>0}isAbove(e){return!this.isBelow(e)}isVertical(){return this.point[0]===this.otherEvent.point[0]}get inResult(){return 0!==this.resultTransition}clone(){const e=new V(this.point,this.left,this.otherEvent,this.isSubject,this.type);return e.contourId=this.contourId,e.resultTransition=this.resultTransition,e.prevInResult=this.prevInResult,e.isExteriorRing=this.isExteriorRing,e.inOut=this.inOut,e.otherInOut=this.otherInOut,e}}function W(e,t){return e[0]===t[0]&&e[1]===t[1]}const $=134217729;function H(e,t,r,n,o){let i,s,a,l,u=t[0],p=n[0],c=0,f=0;p>u==p>-u?(i=u,u=t[++c]):(i=p,p=n[++f]);let h=0;if(c<e&&f<r)for(p>u==p>-u?(s=u+i,a=i-(s-u),u=t[++c]):(s=p+i,a=i-(s-p),p=n[++f]),i=s,0!==a&&(o[h++]=a);c<e&&f<r;)p>u==p>-u?(s=i+u,l=s-i,a=i-(s-l)+(u-l),u=t[++c]):(s=i+p,l=s-i,a=i-(s-l)+(p-l),p=n[++f]),i=s,0!==a&&(o[h++]=a);for(;c<e;)s=i+u,l=s-i,a=i-(s-l)+(u-l),u=t[++c],i=s,0!==a&&(o[h++]=a);for(;f<r;)s=i+p,l=s-i,a=i-(s-l)+(p-l),p=n[++f],i=s,0!==a&&(o[h++]=a);return 0===i&&0!==h||(o[h++]=i),h}function Q(e){return new Float64Array(e)}const X=Q(4),Y=Q(8),Z=Q(12),ee=Q(16),te=Q(4);function re(e,t,r,n,o,i){const s=(t-i)*(r-o),a=(e-o)*(n-i),l=s-a;if(0===s||0===a||s>0!=a>0)return l;const u=Math.abs(s+a);return Math.abs(l)>=33306690738754716e-32*u?l:-function(e,t,r,n,o,i,s){let a,l,u,p,c,f,h,g,y,d,m,v,b,w,P,k,E,S;const O=e-o,_=r-o,M=t-i,j=n-i;w=O*j,f=$*O,h=f-(f-O),g=O-h,f=$*j,y=f-(f-j),d=j-y,P=g*d-(w-h*y-g*y-h*d),k=M*_,f=$*M,h=f-(f-M),g=M-h,f=$*_,y=f-(f-_),d=_-y,E=g*d-(k-h*y-g*y-h*d),m=P-E,c=P-m,X[0]=P-(m+c)+(c-E),v=w+m,c=v-w,b=w-(v-c)+(m-c),m=b-k,c=b-m,X[1]=b-(m+c)+(c-k),S=v+m,c=S-v,X[2]=v-(S-c)+(m-c),X[3]=S;let x=function(e,t){let r=t[0];for(let n=1;n<e;n++)r+=t[n];return r}(4,X),I=22204460492503146e-32*s;if(x>=I||-x>=I)return x;if(c=e-O,a=e-(O+c)+(c-o),c=r-_,u=r-(_+c)+(c-o),c=t-M,l=t-(M+c)+(c-i),c=n-j,p=n-(j+c)+(c-i),0===a&&0===l&&0===u&&0===p)return x;if(I=11093356479670487e-47*s+33306690738754706e-32*Math.abs(x),x+=O*p+j*a-(M*u+_*l),x>=I||-x>=I)return x;w=a*j,f=$*a,h=f-(f-a),g=a-h,f=$*j,y=f-(f-j),d=j-y,P=g*d-(w-h*y-g*y-h*d),k=l*_,f=$*l,h=f-(f-l),g=l-h,f=$*_,y=f-(f-_),d=_-y,E=g*d-(k-h*y-g*y-h*d),m=P-E,c=P-m,te[0]=P-(m+c)+(c-E),v=w+m,c=v-w,b=w-(v-c)+(m-c),m=b-k,c=b-m,te[1]=b-(m+c)+(c-k),S=v+m,c=S-v,te[2]=v-(S-c)+(m-c),te[3]=S;const F=H(4,X,4,te,Y);w=O*p,f=$*O,h=f-(f-O),g=O-h,f=$*p,y=f-(f-p),d=p-y,P=g*d-(w-h*y-g*y-h*d),k=M*u,f=$*M,h=f-(f-M),g=M-h,f=$*u,y=f-(f-u),d=u-y,E=g*d-(k-h*y-g*y-h*d),m=P-E,c=P-m,te[0]=P-(m+c)+(c-E),v=w+m,c=v-w,b=w-(v-c)+(m-c),m=b-k,c=b-m,te[1]=b-(m+c)+(c-k),S=v+m,c=S-v,te[2]=v-(S-c)+(m-c),te[3]=S;const L=H(F,Y,4,te,Z);w=a*p,f=$*a,h=f-(f-a),g=a-h,f=$*p,y=f-(f-p),d=p-y,P=g*d-(w-h*y-g*y-h*d),k=l*u,f=$*l,h=f-(f-l),g=l-h,f=$*u,y=f-(f-u),d=u-y,E=g*d-(k-h*y-g*y-h*d),m=P-E,c=P-m,te[0]=P-(m+c)+(c-E),v=w+m,c=v-w,b=w-(v-c)+(m-c),m=b-k,c=b-m,te[1]=b-(m+c)+(c-k),S=v+m,c=S-v,te[2]=v-(S-c)+(m-c),te[3]=S;const A=H(L,Z,4,te,ee);return ee[A-1]}(e,t,r,n,o,i,u)}function ne(e,t,r){const n=re(e[0],e[1],t[0],t[1],r[0],r[1]);return n>0?-1:n<0?1:0}function oe(e,t){const r=e.point,n=t.point;return r[0]>n[0]?1:r[0]<n[0]?-1:r[1]!==n[1]?r[1]>n[1]?1:-1:function(e,t,r,n){if(e.left!==t.left)return e.left?1:-1;if(0!==ne(r,e.otherEvent.point,t.otherEvent.point))return e.isBelow(t.otherEvent.point)?-1:1;return!e.isSubject&&t.isSubject?1:-1}(e,t,r)}function ie(e,t,r){const n=new V(t,!1,e,e.isSubject),o=new V(t,!0,e.otherEvent,e.isSubject);return W(e.point,e.otherEvent.point)&&console.warn("what is that, a collapsed segment?",e),n.contourId=o.contourId=e.contourId,oe(o,e.otherEvent)>0&&(e.otherEvent.left=!0,o.left=!1),e.otherEvent.otherEvent=o,e.otherEvent=n,r.push(o),r.push(n),r}function se(e,t){return e[0]*t[1]-e[1]*t[0]}function ae(e,t){return e[0]*t[0]+e[1]*t[1]}function le(e,t,r){const n=function(e,t,r,n,o){const i=[t[0]-e[0],t[1]-e[1]],s=[n[0]-r[0],n[1]-r[1]];function a(e,t,r){return[e[0]+t*r[0],e[1]+t*r[1]]}const l=[r[0]-e[0],r[1]-e[1]];let u=se(i,s),p=u*u;const c=ae(i,i);if(p>0){const t=se(l,s)/u;if(t<0||t>1)return null;const n=se(l,i)/u;return n<0||n>1?null:0===t||1===t?o?null:[a(e,t,i)]:0===n||1===n?o?null:[a(r,n,s)]:[a(e,t,i)]}if(u=se(l,i),p=u*u,p>0)return null;const f=ae(i,l)/c,h=f+ae(i,s)/c,g=Math.min(f,h),y=Math.max(f,h);return g<=1&&y>=0?1===g?o?null:[a(e,g>0?g:0,i)]:0===y?o?null:[a(e,y<1?y:1,i)]:o&&0===g&&1===y?null:[a(e,g>0?g:0,i),a(e,y<1?y:1,i)]:null}(e.point,e.otherEvent.point,t.point,t.otherEvent.point),o=n?n.length:0;if(0===o)return 0;if(1===o&&(W(e.point,t.point)||W(e.otherEvent.point,t.otherEvent.point)))return 0;if(2===o&&e.isSubject===t.isSubject)return 0;if(1===o)return W(e.point,n[0])||W(e.otherEvent.point,n[0])||ie(e,n[0],r),W(t.point,n[0])||W(t.otherEvent.point,n[0])||ie(t,n[0],r),1;const i=[];let s=!1,a=!1;return W(e.point,t.point)?s=!0:1===oe(e,t)?i.push(t,e):i.push(e,t),W(e.otherEvent.point,t.otherEvent.point)?a=!0:1===oe(e.otherEvent,t.otherEvent)?i.push(t.otherEvent,e.otherEvent):i.push(e.otherEvent,t.otherEvent),s&&a||s?(t.type=1,e.type=t.inOut===e.inOut?2:3,s&&!a&&ie(i[1].otherEvent,i[0].point,r),2):a?(ie(i[0],i[1].point,r),3):i[0]!==i[3].otherEvent?(ie(i[0],i[1].point,r),ie(i[1],i[2].point,r),3):(ie(i[0],i[1].point,r),ie(i[3].otherEvent,i[2].point,r),3)}function ue(e,t){if(e===t)return 0;if(0!==ne(e.point,e.otherEvent.point,t.point)||0!==ne(e.point,e.otherEvent.point,t.otherEvent.point))return W(e.point,t.point)?e.isBelow(t.otherEvent.point)?-1:1:e.point[0]===t.point[0]?e.point[1]<t.point[1]?-1:1:1===oe(e,t)?t.isAbove(e.point)?-1:1:e.isBelow(t.point)?-1:1;if(e.isSubject!==t.isSubject)return e.isSubject?-1:1;{let r=e.point,n=t.point;if(r[0]===n[0]&&r[1]===n[1])return r=e.otherEvent.point,n=t.otherEvent.point,r[0]===n[0]&&r[1]===n[1]?0:e.contourId>t.contourId?1:-1}return 1===oe(e,t)?1:-1}class pe{constructor(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null}isExterior(){return null==this.holeOf}}function ce(e,t,r,n){let o,i=e+1,s=t[e].point;const a=t.length;for(i<a&&(o=t[i].point);i<a&&o[0]===s[0]&&o[1]===s[1];){if(!r[i])return i;i++,i<a&&(o=t[i].point)}for(i=e-1;r[i]&&i>n;)i--;return i}function fe(e,t,r){const n=new pe;if(null!=e.prevInResult){const o=e.prevInResult,i=o.outputContourId;if(o.resultTransition>0){const e=t[i];if(null!=e.holeOf){const o=e.holeOf;t[o].holeIds.push(r),n.holeOf=o,n.depth=t[i].depth}else t[i].holeIds.push(r),n.holeOf=i,n.depth=t[i].depth+1}else n.holeOf=null,n.depth=t[i].depth}else n.holeOf=null,n.depth=0;return n}function he(e){let t,r;const n=function(e){let t,r,n,o;const i=[];for(r=0,n=e.length;r<n;r++)t=e[r],(t.left&&t.inResult||!t.left&&t.otherEvent.inResult)&&i.push(t);let s=!1;for(;!s;)for(s=!0,r=0,n=i.length;r<n;r++)r+1<n&&1===oe(i[r],i[r+1])&&(o=i[r],i[r]=i[r+1],i[r+1]=o,s=!1);for(r=0,n=i.length;r<n;r++)t=i[r],t.otherPos=r;for(r=0,n=i.length;r<n;r++)t=i[r],t.left||(o=t.otherPos,t.otherPos=t.otherEvent.otherPos,t.otherEvent.otherPos=o);return i}(e),o={},i=[];for(t=0,r=n.length;t<r;t++){if(o[t])continue;const e=i.length,r=fe(n[t],i,e),s=t=>{o[t]=!0,t<n.length&&n[t]&&(n[t].outputContourId=e)};let a=t,l=t;const u=n[t].point;for(r.points.push(u);s(a),a=n[a].otherPos,s(a),r.points.push(n[a].point),a=ce(a,n,o,l),!(a==l||a>=n.length)&&n[a];);i.push(r)}return i}var ge=de,ye=de;function de(e,t){if(!(this instanceof de))return new de(e,t);if(this.data=e||[],this.length=this.data.length,this.compare=t||me,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)}function me(e,t){return e<t?-1:e>t?1:0}de.prototype={push:function(e){this.data.push(e),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var e=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e}},peek:function(){return this.data[0]},_up:function(e){for(var t=this.data,r=this.compare,n=t[e];e>0;){var o=e-1>>1,i=t[o];if(r(n,i)>=0)break;t[e]=i,e=o}t[e]=n},_down:function(e){for(var t=this.data,r=this.compare,n=this.length>>1,o=t[e];e<n;){var i=1+(e<<1),s=i+1,a=t[i];if(s<this.length&&r(t[s],a)<0&&(i=s,a=t[s]),r(a,o)>=0)break;t[e]=a,e=i}t[e]=o}},ge.default=ye;const ve=Math.max,be=Math.min;let we=0;function Pe(e,t,r,n,o,i){let s,a,l,u,p,c;for(s=0,a=e.length-1;s<a;s++){if(l=e[s],u=e[s+1],p=new V(l,!1,void 0,t),c=new V(u,!1,p,t),p.otherEvent=c,l[0]===u[0]&&l[1]===u[1])continue;p.contourId=c.contourId=r,i||(p.isExteriorRing=!1,c.isExteriorRing=!1),oe(p,c)>0?c.left=!0:p.left=!0;const a=l[0],f=l[1];o[0]=be(o[0],a),o[1]=be(o[1],f),o[2]=ve(o[2],a),o[3]=ve(o[3],f),n.push(p),n.push(c)}}const ke=[];function Ee(e,t,r){"number"==typeof e[0][0][0]&&(e=[e]),"number"==typeof t[0][0][0]&&(t=[t]);let n=function(e,t,r){let n=null;return e.length*t.length==0&&(0===r?n=ke:2===r?n=e:1!==r&&3!==r||(n=0===e.length?t:e)),n}(e,t,r);if(n)return n===ke?null:n;const o=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],s=function(e,t,r,n,o){const i=new ge(null,oe);let s,a,l,u,p,c;for(l=0,u=e.length;l<u;l++)for(s=e[l],p=0,c=s.length;p<c;p++)a=0===p,a&&we++,Pe(s[p],!0,we,i,r,a);for(l=0,u=t.length;l<u;l++)for(s=t[l],p=0,c=s.length;p<c;p++)a=0===p,2===o&&(a=!1),a&&we++,Pe(s[p],!1,we,i,n,a);return i}(e,t,o,i,r);if(n=function(e,t,r,n,o){let i=null;return(r[0]>n[2]||n[0]>r[2]||r[1]>n[3]||n[1]>r[3])&&(0===o?i=ke:2===o?i=e:1!==o&&3!==o||(i=e.concat(t))),i}(e,t,o,i,r),n)return n===ke?null:n;const a=he(function(e,t,r,n,o,i){const s=new z(ue),a=[],l=Math.min(n[2],o[2]);let u,p,c;for(;0!==e.length;){let t=e.pop();if(a.push(t),0===i&&t.point[0]>l||2===i&&t.point[0]>n[2])break;if(t.left){p=u=s.insert(t),c=s.minNode(),u=u!==c?s.prev(u):null,p=s.next(p);const r=u?u.key:null;let n;if(K(t,r,i),p&&2===le(t,p.key,e)&&(K(t,r,i),K(p.key,t,i)),u&&2===le(u.key,t,e)){let e=u;e=e!==c?s.prev(e):null,n=e?e.key:null,K(r,n,i),K(t,r,i)}}else t=t.otherEvent,p=u=s.find(t),u&&p&&(u=u!==c?s.prev(u):null,p=s.next(p),s.remove(t),p&&u&&le(u.key,p.key,e))}return a}(s,0,0,o,i,r)),l=[];for(let e=0;e<a.length;e++){let t=a[e];if(t.isExterior()){let e=[t.points];for(let r=0;r<t.holeIds.length;r++){let n=t.holeIds[r];e.push(a[n].points)}l.push(e)}}return l}var Se=function(e,t){for(var r=e[0],n=e[1],o=!1,i=0,s=t.length-1;i<t.length;s=i++){var a=t[i][0],l=t[i][1],u=t[s][0],p=t[s][1];l>n!=p>n&&r<(u-a)*(n-l)/(p-l)+a&&(o=!o)}return o},Oe=function(e){if("Point"!==e.geometry.type){switch(e.properties.way_geometry=r({},e.geometry),e.geometry.type){case"Polygon":e.properties.mesure=T(e.geometry);break;case"LineString":e.properties.mesure=G(e)}e.geometry=F(e.geometry).geometry}},_e=function(e){if("no"===e.area)return!1;var t=Object.keys(e);return!(!t.includes("building")||"no"===e.building)||(!(!t.includes("landuse")||"no"===e.landuse)||(!(!t.includes("amenity")||"no"===e.amenity)||(!(!t.includes("leisure")||"no"===e.leisure)||(!(!t.includes("area")||"no"===e.area)||(!(!t.includes("place")||"no"===e.place)||(!(!t.includes("shop")||"no"===e.shop)||(!(!t.includes("boundary")||"no"===e.boundary)||(!(!t.includes("tourism")||"no"===e.tourism)||(!(!t.includes("historic")||"no"===e.historic)||(!(!t.includes("public_transport")||"no"===e.public_transport)||(!(!t.includes("office")||"no"===e.office)||(!(!t.includes("building:part")||"no"===e["building:part"])||(!(!t.includes("military")||"no"===e.military)||(!(!t.includes("ruins")||"no"===e.ruins)||(!(!t.includes("craft")||"no"===e.craft)||(!(!t.includes("golf")||"no"===e.golf)||(!(!t.includes("indoor")||"no"===e.indoor)||(!(!t.includes("highway")||!["services","rest_area","escape","elevator"].includes(e.highway))||(!(!t.includes("waterway")||!["riverbank","dock","boatyard","dam"].includes(e.waterway))||(!(!t.includes("barrier")||!["city_wall","ditch","hedge","retaining_wall","wall","spikes"].includes(e.barrier))||(!(!t.includes("railway")||!["station","turntable","roundhouse","platform"].includes(e.railway))||(!(!t.includes("power")||!["plant","substation","generator","transformer"].includes(e.power))||(!(!t.includes("natural")||["coastline","cliff","ridge","arete","tree_row"].includes(e.natural))||(!(!t.includes("man_made")||["cutline","embankment","pipeline"].includes(e.man_made))||!(!t.includes("aeroway")||["taxiway"].includes(e.aeroway))))))))))))))))))))))))))},Me=function(e,t){if(!t)return!0;if(!e)return!1;for(var r=0,n=Object.keys(e);r<n.length;r++){var o=n[r];if(t.includes(o))return!0}return!1},je=function(e,t){var r=e.properties.tags;for(var n in r)if(t.includes(n))return{key:n,value:r[n]};return null};function xe(e,t){var r,n=e.properties.configId,i="".concat(e.properties.primaryTag.key,"/").concat(e.properties.primaryTag.value),s=e.properties.tags,l=0,u={exact:void 0,presets:[],moreFields:[]},p=a(t);try{for(p.s();!(r=p.n()).done;){var c=r.value,f=c.id;if(n)n.includes(f)&&(c.presets&&(u.presets=[].concat(o(u.presets),o(c.presets))),c.moreFields&&(u.moreFields=[].concat(o(u.moreFields),o(c.moreFields)))),n==f&&(u.exact=c);else{if(!f.includes(i))continue;var h=0;for(var g in c.tags)s[g]&&s[g]===c.tags[g]&&h++;h==Object.keys(c.tags).length&&(c.presets&&(u.presets=[].concat(o(u.presets),o(c.presets))),c.moreFields&&(u.moreFields=[].concat(o(u.moreFields),o(c.moreFields))),h>l&&(u.exact=c,l=h))}}}catch(e){p.e(e)}finally{p.f()}if(u.exact){var y=JSON.parse(JSON.stringify(u.exact));return y.presets=u.presets,y.moreFields=u.moreFields,y}var d=e.properties.primaryTag.k?"k":"key",m=e.properties.primaryTag.k?"v":"value",v="".concat(e.properties.primaryTag[d],"/").concat(e.properties.primaryTag[m]),b={key:e.properties.primaryTag[d],icon:"wiki-question",markerColor:"#000000",lbl:{en:"".concat(e.properties.primaryTag[d]," = ").concat(e.properties.primaryTag[m])},presets:[],geometry:[],tags:{},id:v,unknowTags:!0};return b.tags[e.properties.primaryTag[d]]=e.properties.primaryTag[m],b}function Ie(e){e.properties.tags.name?e.properties._name=e.properties.tags.name:e.properties.tags.ref&&(e.properties._name=e.properties.tags.ref),e.properties.meta.timestamp&&(e.properties.time=new Date(e.properties.meta.timestamp).getTime()),e.properties.tags.fixme&&(e.properties.fixme=!0)}function Fe(e,t){var r,n=xe(e,t);return r="node"===e.properties.type?"circle":"LineString"===e.properties.way_geometry.type||"MultiLineString"===e.properties.way_geometry.type?"penta":"Polygon"===e.properties.way_geometry.type||"MultiPolygon"===e.properties.way_geometry.type?"square":"star",e.properties.icon=n.icon?n.icon:"maki-circle",e.properties.marker="".concat(r,"-").concat(n.markerColor,"-").concat(e.properties.icon),e.properties.hexColor=n.markerColor,e.properties.configId=n.id,n.unknowTags&&(e.properties.unknowTags=!0),n.deprecated?e.properties.deprecated=n.deprecated:e.properties.deprecated&&delete e.properties.deprecated,Ie(e),e}var Le=function(e,t){if(!t)return e;for(var n=[],o=0;o<t.features.length;o++)n.push(t.features[o].id);for(var i=e.features.length-1;i>=0;i--)n.includes(e.features[i].id)&&e.features.splice(i,1);return r({},e)},Ae=function(e,t){var r,n;return t&&0!==t.length?{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"MultiPolygon",coordinates:(r=t.geometry.coordinates,n=e.geometry.coordinates,Ee(r,n,1))}}]}:{type:"FeatureCollection",features:[e]}};return e.addAttributesToFeature=Ie,e.convert=function(e,t){var n=null;t&&t.primaryKeys&&(n=t.primaryKeys);var i,s="string"==typeof e?JSON.parse(e):e,l={minlat:Number(s.bounds.minlat),minlon:Number(s.bounds.minlon),maxlat:Number(s.bounds.maxlat),maxlon:Number(s.bounds.maxlon)},u=[l.minlon,l.minlat,l.maxlon,l.maxlat],p=function(e,t){for(var r=e[0]==e[e.length-1]?"Polygon":"LineString",n=[],o=0;o<e.length;o++){var i="node/".concat(e[o]);t[i]&&n.push(t[i].geometry.coordinates)}return"LineString"==r?{type:"LineString",coordinates:n}:"Polygon"==r?{type:"Polygon",coordinates:[n]}:void 0},c=function(e,t){var n=r({},e),i=Array.isArray(n.members)?n.members:[n.members];n.tainted=!1;for(var s=0;s<i.length;s++){var l=i[s],u="".concat(l.type,"/").concat(l.ref);if(t[u]){var p=t[u].geometry,c=void 0;"LineString"===p.type?(l.typeGeom="LineString",c=o(p.coordinates)):"Polygon"===p.type&&(l.typeGeom="Polygon",c=o(p.coordinates[0])),l.ring=c}else l.ring=null,n.tainted=!0}if(n.tainted)return null;Array.isArray(i)||(i=[i]);var h=i.filter((function(e){return"outer"===e.role&&"Polygon"===e.typeGeom&&e.ring})),g=i.filter((function(e){return"inner"===e.role&&"Polygon"===e.typeGeom&&e.ring})),y=i.filter((function(e){return"outer"===e.role&&"LineString"===e.typeGeom&&e.ring})),d=i.filter((function(e){return"inner"===e.role&&"LineString"===e.typeGeom&&e.ring}));if(0===h.length&&0===y.length)return null;if(y.length>0){var m,v=a(f(y.map((function(e){return e.ring}))));try{for(v.s();!(m=v.n()).done;){var b=m.value;h.push({type:"way",ref:"",role:"outer",typeGeom:"Polygon",ring:b})}}catch(e){v.e(e)}finally{v.f()}}if(d.length>0){var w,P=a(f(d.map((function(e){return e.ring}))));try{for(P.s();!(w=P.n()).done;){var k=w.value;g.push({type:"way",ref:"",role:"inner",typeGeom:"Polygon",ring:k})}}catch(e){P.e(e)}finally{P.f()}}if(1==h.length){var E,S=[h[0].ring],O=a(g);try{for(O.s();!(E=O.n()).done;){var _=E.value;S.push(_.ring)}}catch(e){O.e(e)}finally{O.f()}return{type:"Polygon",coordinates:S}}var M,j=h.map((function(e){return[e.ring]})),x=a(g);try{for(x.s();!(M=x.n()).done;)for(var I=M.value,F=0;F<j.length;F++){var L=j[F][0],A=I.ring[0];Se(A,L)&&j[F].push(I.ring)}}catch(e){x.e(e)}finally{x.f()}return{type:"MultiPolygon",coordinates:j}},f=function(e){var t=[],r=e[0].slice();e.splice(0,1);for(var n=r[0].toString(),i=r[r.length-1].toString(),s=0;0!=e.length&&s<e.length;)e[s][0].toString()==i?(e[s].splice(0,1),r=[].concat(o(r),o(e[s])),e.splice(s,1),n=r[0].toString(),i=r[r.length-1].toString(),s=0):e[s][e[s].length-1].toString()==n?(e[s].splice(e[s].length-1,1),r=[].concat(o(e[s]),o(r)),e.splice(s,1),n=r[0].toString(),i=r[r.length-1].toString(),s=0):e[s][0].toString()==n?(e[s].splice(0,1),r=[].concat(o(e[s].reverse()),o(r)),e.splice(s,1),n=r[0].toString(),i=r[r.length-1].toString(),s=0):e[s][e[s].length-1].toString()==i?(e[s].splice(e[s].length-1,1),r=[].concat(o(r),o(e[s].reverse())),e.splice(s,1),n=r[0].toString(),i=r[r.length-1].toString(),s=0):s++,n==i&&(t.push(r),e.length>0&&(r=e[0].slice(),e.splice(0,1),n=r[0].toString(),i=r[r.length-1].toString(),s=0));return t},h=[],g=[],y=a(s.elements);try{for(y.s();!(i=y.n()).done;){var d=i.value;if("node"===d.type){var m=d,v={type:"Feature",id:"node/".concat(d.id),properties:{type:"node",id:d.id,meta:{timestamp:d.timestamp,version:d.version,changeset:d.changeset,user:d.user,uid:d.uid}},geometry:{type:"Point",coordinates:[d.lon,d.lat]}};d.tags&&(v.properties.tags=d.tags),g["node/".concat(m.id)]=v}else if("way"===d.type){var b=d,w={type:"Feature",id:"way/".concat(d.id),properties:{type:"way",id:d.id,meta:{timestamp:d.timestamp,version:d.version,changeset:b.changeset,user:d.user,uid:d.uid}}};if(d.tags&&(w.properties.tags=d.tags),d.nodes){var P,k=[],E=a(d.nodes);try{for(E.s();!(P=E.n()).done;){var S=P.value;k.push(S);var O=g["node/".concat(S)];O&&(O.properties.usedByWays||(O.properties.usedByWays=[]),O.properties.usedByWays.push("way/".concat(d.id)))}}catch(e){E.e(e)}finally{E.f()}w.ndRefs=k,w.geometry=p(k,g)}g["way/".concat(d.id)]=w}else if("relation"===d.type){var _={type:"Feature",id:"relation/".concat(d.id),properties:{type:"relation",id:d.id,meta:{timestamp:d.timestamp,version:d.version,changeset:d.changeset,user:d.user,uid:d.uid}},members:d.members,tainted:!1};d.tags&&(_.properties.tags=d.tags),Array.isArray(d.members)||(d.members=[d.members]);var M,j=a(d.members);try{for(j.s();!(M=j.n()).done;){var I=M.value,F="".concat(I.type,"/").concat(I.ref);g[F]?(g[F].properties.relations||(g[F].properties.relations=[]),g[F].properties.relations.push({rel:_.id,reltags:_.properties.tags,role:I.role})):_.tainted=!0}}catch(e){j.e(e)}finally{j.f()}"multipolygon"===_.properties.tags.type&&h.push("relation/".concat(_.id)),g["relation/".concat(_.id)]=_}}}catch(e){y.e(e)}finally{y.f()}for(var L=0,A=h;L<A.length;L++){var T=A[L],C=c(g[T],g);C&&(g[T].geometry=C)}var N={type:"FeatureCollection",features:function(e,t,r){var o=[];for(var i in e){var s=e[i];if("node"==s.properties.type){if(s.geometry&&s.properties.tags)if(t){var a=je(s,r);a&&(s.properties.primaryTag=a,Fe(s,t),o.push(s))}else Ie(s),o.push(s)}else if("way"==s.properties.type){if(s.geometry&&s.properties.tags)if("Polygon"!=s.geometry.type&&"MultiPolygon"!=s.geometry.type||_e(s.properties.tags)||(s.geometry.coordinates=s.geometry.coordinates[0],s.geometry.type="Polygon"==s.geometry.type?"LineString":"MultiLineString"),Oe(s),t){var l=je(s,r);l&&(s.properties.primaryTag=l,Fe(s,t),o.push(s))}else Ie(s),o.push(s)}else if("relation"==s.properties.type&&s.geometry&&s.properties.tags&&Me(s.properties.tags,n))if("Polygon"!=s.geometry.type&&"MultiPolygon"!=s.geometry.type||_e(s.properties.tags)||(s.geometry.coordinates=s.geometry.coordinates[0],s.geometry.type="Polygon"==s.geometry.type?"LineString":"MultiLineString"),Oe(s),t){var u=je(s,r);u&&(s.properties.primaryTag=u,Fe(s,t),o.push(s))}else Ie(s),o.push(s)}return o}(g,t.tagConfig,t.primaryKeys)};if(t&&t.oldGeojson&&t.geojsonChanged){var R=Number.isInteger(t.limitFeatures)?t.limitFeatures:9999,G=B(u);return t.oldGeojson.features.length>R?{geojson:Le(N,t.geojsonChanged),geojsonBbox:Ae(G,null)}:{geojson:function(e,t,r,n){var o=e.features,i=t.features;if(!o||0==o.length)return t;for(var s=[],a=0;a<o.length;a++)x(o[a],r)&&s.push(o[a].id);for(var l=0;l<i.length;l++)for(var u=i[l].id,p=0;p<o.length;p++){if(u==o[p].id){o[p]=i[l],s.splice(s.indexOf(u),1);break}p==o.length-1&&o.push(i[l])}for(var c=0;c<s.length;c++)for(var f=s[c],h=0;h<o.length;h++)if(o[h].id==f){o.splice(h,1);break}return Le(e,n)}(t.oldGeojson,N,G,t.geojsonChanged),geojsonBbox:Ae(G,t.oldBboxFeature)}}return{geojson:N,geojsonBbox:null}},e.getConfigTag=xe,e.setIconStyle=Fe,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
