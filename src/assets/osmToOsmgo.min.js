var osmToOsmgo=function(t){"use strict";function e(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function r(t){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?e(Object(o),!0).forEach((function(e){n(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function n(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function o(t){return function(t){if(Array.isArray(t))return a(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||i(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){if(t){if("string"==typeof t)return a(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(t,e):void 0}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function s(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=i(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return s=t.done,t},e:function(t){u=!0,a=t},f:function(){try{s||null==r.return||r.return()}finally{if(u)throw a}}}}var u=6371008.8,l={centimeters:637100880,centimetres:637100880,degrees:57.22891354143274,feet:20902260.511392,inches:39.37*u,kilometers:6371.0088,kilometres:6371.0088,meters:u,metres:u,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:u/1852,radians:1,yards:6967335.223679999};function p(t,e,r){void 0===r&&(r={});var n={type:"Feature"};return(0===r.id||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=e||{},n.geometry=t,n}function c(t,e,r){if(void 0===r&&(r={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!y(t[0])||!y(t[1]))throw new Error("coordinates must contain numbers");return p({type:"Point",coordinates:t},e,r)}function f(t,e,r){if(void 0===r&&(r={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return p({type:"LineString",coordinates:t},e,r)}function h(t,e){void 0===e&&(e={});var r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}function g(t){return t%360*Math.PI/180}function y(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function d(t,e,r){if(null!==t)for(var n,o,i,a,s,u,l,p,c=0,f=0,h=t.type,g="FeatureCollection"===h,y="Feature"===h,m=g?t.features.length:1,v=0;v<m;v++){s=(p=!!(l=g?t.features[v].geometry:y?t.geometry:t)&&"GeometryCollection"===l.type)?l.geometries.length:1;for(var b=0;b<s;b++){var w=0,P=0;if(null!==(a=p?l.geometries[b]:l)){u=a.coordinates;var k=a.type;switch(c=!r||"Polygon"!==k&&"MultiPolygon"!==k?0:1,k){case null:break;case"Point":if(!1===e(u,f,v,w,P))return!1;f++,w++;break;case"LineString":case"MultiPoint":for(n=0;n<u.length;n++){if(!1===e(u[n],f,v,w,P))return!1;f++,"MultiPoint"===k&&w++}"LineString"===k&&w++;break;case"Polygon":case"MultiLineString":for(n=0;n<u.length;n++){for(o=0;o<u[n].length-c;o++){if(!1===e(u[n][o],f,v,w,P))return!1;f++}"MultiLineString"===k&&w++,"Polygon"===k&&P++}"Polygon"===k&&w++;break;case"MultiPolygon":for(n=0;n<u.length;n++){for(P=0,o=0;o<u[n].length;o++){for(i=0;i<u[n][o].length-c;i++){if(!1===e(u[n][o][i],f,v,w,P))return!1;f++}P++}w++}break;case"GeometryCollection":for(n=0;n<a.geometries.length;n++)if(!1===d(a.geometries[n],e,r))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function m(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var r=0;r<t.features.length&&!1!==e(t.features[r],r);r++);}function v(t,e){var r,n,o,i,a,s,u,l,p,c,f=0,h="FeatureCollection"===t.type,g="Feature"===t.type,y=h?t.features.length:1;for(r=0;r<y;r++){for(s=h?t.features[r].geometry:g?t.geometry:t,l=h?t.features[r].properties:g?t.properties:{},p=h?t.features[r].bbox:g?t.bbox:void 0,c=h?t.features[r].id:g?t.id:void 0,a=(u=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,o=0;o<a;o++)if(null!==(i=u?s.geometries[o]:s))switch(i.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(i,f,l,p,c))return!1;break;case"GeometryCollection":for(n=0;n<i.geometries.length;n++)if(!1===e(i.geometries[n],f,l,p,c))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,f,l,p,c))return!1;f++}}function b(t,e){!function(t,e){v(t,(function(t,r,n,o,i){var a,s=null===t?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return!1!==e(p(t,n,{bbox:o,id:i}),r,0)&&void 0}switch(s){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon"}for(var u=0;u<t.coordinates.length;u++){var l=t.coordinates[u];if(!1===e(p({type:a,coordinates:l},n),r,u))return!1}}))}(t,(function(t,r,n){var o=0;if(t.geometry){var i=t.geometry.type;if("Point"!==i&&"MultiPoint"!==i){var a,s=0,u=0,l=0;return!1!==d(t,(function(i,p,c,h,g){if(void 0===a||r>s||h>u||g>l)return a=i,s=r,u=h,l=g,void(o=0);var y=f([a,i],t.properties);if(!1===e(y,r,n,g,o))return!1;o++,a=i}))&&void 0}}}))}function w(t){var e=[];return"FeatureCollection"===t.type?m(t,(function(t){d(t,(function(r){e.push(c(r,t.properties))}))})):d(t,(function(r){e.push(c(r,t.properties))})),h(e)}function P(t){var e=[1/0,1/0,-1/0,-1/0];return d(t,(function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])})),e}function k(t){if(!t)throw new Error("geojson is required");switch(t.type){case"Feature":return E(t);case"FeatureCollection":return function(t){var e={type:"FeatureCollection"};return Object.keys(t).forEach((function(r){switch(r){case"type":case"features":return;default:e[r]=t[r]}})),e.features=t.features.map((function(t){return E(t)})),e}(t);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return O(t);default:throw new Error("unknown GeoJSON type")}}function E(t){var e={type:"Feature"};return Object.keys(t).forEach((function(r){switch(r){case"type":case"properties":case"geometry":return;default:e[r]=t[r]}})),e.properties=S(t.properties),e.geometry=O(t.geometry),e}function S(t){var e={};return t?(Object.keys(t).forEach((function(r){var n=t[r];"object"==typeof n?null===n?e[r]=null:Array.isArray(n)?e[r]=n.map((function(t){return t})):e[r]=S(n):e[r]=n})),e):e}function O(t){var e={type:t.type};return t.bbox&&(e.bbox=t.bbox),"GeometryCollection"===t.type?(e.geometries=t.geometries.map((function(t){return O(t)})),e):(e.coordinates=_(t.coordinates),e)}function _(t){var e=t;return"object"!=typeof e[0]?e.slice():e.map((function(t){return _(t)}))}function M(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return t.geometry.coordinates;if("Point"===t.type)return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function j(t,e,r){void 0===r&&(r={});var n=M(t),o=M(e),i=g(o[1]-n[1]),a=g(o[0]-n[0]),s=g(n[1]),u=g(o[1]),p=Math.pow(Math.sin(i/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(s)*Math.cos(u);return function(t,e){void 0===e&&(e="kilometers");var r=l[e];if(!r)throw new Error(e+" units is invalid");return t*r}(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)),r.units)}function x(t,e,r){if(void 0===r&&(r={}),!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");var n,o=M(t),i="Feature"===(n=e).type?n.geometry:n,a=i.type,s=e.bbox,u=i.coordinates;if(s&&!1===function(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}(o,s))return!1;"Polygon"===a&&(u=[u]);for(var l=!1,p=0;p<u.length&&!l;p++)if(I(o,u[p][0],r.ignoreBoundary)){for(var c=!1,f=1;f<u[p].length&&!c;)I(o,u[p][f],!r.ignoreBoundary)&&(c=!0),f++;c||(l=!0)}return l}function I(t,e,r){var n=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var o=0,i=e.length-1;o<e.length;i=o++){var a=e[o][0],s=e[o][1],u=e[i][0],l=e[i][1];if(t[1]*(a-u)+s*(u-t[0])+l*(t[0]-a)==0&&(a-t[0])*(u-t[0])<=0&&(s-t[1])*(l-t[1])<=0)return!r;s>t[1]!=l>t[1]&&t[0]<(u-a)*(t[1]-s)/(l-s)+a&&(n=!n)}return n}function L(t){for(var e=function(t){if("FeatureCollection"!==t.type)return"Feature"!==t.type?h([p(t)]):h([t]);return t}(t),r=function(t,e){void 0===e&&(e={});var r=P(t);return c([(r[0]+r[2])/2,(r[1]+r[3])/2],e.properties,e)}(e),n=!1,o=0;!n&&o<e.features.length;){var i,a=e.features[o].geometry,s=!1;if("Point"===a.type)r.geometry.coordinates[0]===a.coordinates[0]&&r.geometry.coordinates[1]===a.coordinates[1]&&(n=!0);else if("MultiPoint"===a.type){var u=!1;for(i=0;!u&&i<a.coordinates.length;)r.geometry.coordinates[0]===a.coordinates[i][0]&&r.geometry.coordinates[1]===a.coordinates[i][1]&&(n=!0,u=!0),i++}else if("LineString"===a.type)for(i=0;!s&&i<a.coordinates.length-1;)A(r.geometry.coordinates[0],r.geometry.coordinates[1],a.coordinates[i][0],a.coordinates[i][1],a.coordinates[i+1][0],a.coordinates[i+1][1])&&(s=!0,n=!0),i++;else if("MultiLineString"===a.type)for(var l=0;l<a.coordinates.length;){s=!1,i=0;for(var f=a.coordinates[l];!s&&i<f.length-1;)A(r.geometry.coordinates[0],r.geometry.coordinates[1],f[i][0],f[i][1],f[i+1][0],f[i+1][1])&&(s=!0,n=!0),i++;l++}else"Polygon"!==a.type&&"MultiPolygon"!==a.type||x(r,a)&&(n=!0);o++}if(n)return r;var g=h([]);for(o=0;o<e.features.length;o++)g.features=g.features.concat(w(e.features[o]).features);return c(function(t,e){if(!t)throw new Error("targetPoint is required");if(!e)throw new Error("points is required");var r,n=1/0,o=0;return m(e,(function(e,r){var i=j(t,e);i<n&&(o=r,n=i)})),(r=k(e.features[o])).properties.featureIndex=o,r.properties.distanceToPoint=n,r}(r,g).geometry.coordinates)}function A(t,e,r,n,o,i){return Math.sqrt((o-r)*(o-r)+(i-n)*(i-n))===Math.sqrt((t-r)*(t-r)+(e-n)*(e-n))+Math.sqrt((o-t)*(o-t)+(i-e)*(i-e))}P.default=P;var T=6378137;function C(t){return function(t,e,r){var n=r;return v(t,(function(t,o,i,a,s){n=0===o&&void 0===r?t:e(n,t,o,i,a,s)})),n}(t,(function(t,e){return t+function(t){var e,r=0;switch(t.type){case"Polygon":return F(t.coordinates);case"MultiPolygon":for(e=0;e<t.coordinates.length;e++)r+=F(t.coordinates[e]);return r;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}(e)}),0)}function F(t){var e=0;if(t&&t.length>0){e+=Math.abs(N(t[0]));for(var r=1;r<t.length;r++)e-=Math.abs(N(t[r]))}return e}function N(t){var e,r,n,o,i,a,s=0,u=t.length;if(u>2){for(a=0;a<u;a++)a===u-2?(n=u-2,o=u-1,i=0):a===u-1?(n=u-1,o=0,i=1):(n=a,o=a+1,i=a+2),e=t[n],r=t[o],s+=(R(t[i][0])-R(e[0]))*Math.sin(R(r[1]));s=s*T*T/2}return s}function R(t){return t*Math.PI/180}function G(t,e){return void 0===e&&(e={}),function(t,e,r){var n=r,o=!1;return b(t,(function(t,i,a,s,u){n=!1===o&&void 0===r?t:e(n,t,i,a,s,u),o=!0})),n}(t,(function(t,r){var n=r.geometry.coordinates;return t+j(n[0],n[1],e)}),0)}function B(t,e){void 0===e&&(e={});var r=Number(t[0]),n=Number(t[1]),o=Number(t[2]),i=Number(t[3]);if(6===t.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var a=[r,n];return function(t,e,r){void 0===r&&(r={});for(var n=0,o=t;n<o.length;n++){var i=o[n];if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<i[i.length-1].length;a++)if(i[i.length-1][a]!==i[0][a])throw new Error("First and last Position are not equivalent.")}return p({type:"Polygon",coordinates:t},e,r)}([[a,[o,n],[o,i],[r,i],a]],e.properties,{bbox:t,id:e.id})}function q(t,e){return t>e?1:t<e?-1:0}class z{constructor(t=q,e=!1){this._compare=t,this._root=null,this._size=0,this._noDuplicates=!!e}rotateLeft(t){var e=t.right;e&&(t.right=e.left,e.left&&(e.left.parent=t),e.parent=t.parent),t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.left=t),t.parent=e}rotateRight(t){var e=t.left;e&&(t.left=e.right,e.right&&(e.right.parent=t),e.parent=t.parent),t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.right=t),t.parent=e}_splay(t){for(;t.parent;){var e=t.parent;e.parent?e.left===t&&e.parent.left===e?(this.rotateRight(e.parent),this.rotateRight(e)):e.right===t&&e.parent.right===e?(this.rotateLeft(e.parent),this.rotateLeft(e)):e.left===t&&e.parent.right===e?(this.rotateRight(e),this.rotateLeft(e)):(this.rotateLeft(e),this.rotateRight(e)):e.left===t?this.rotateRight(e):this.rotateLeft(e)}}splay(t){for(var e,r,n,o,i;t.parent;)(r=(e=t.parent).parent)&&r.parent?((n=r.parent).left===r?n.left=t:n.right=t,t.parent=n):(t.parent=null,this._root=t),o=t.left,i=t.right,t===e.left?(r&&(r.left===e?(e.right?(r.left=e.right,r.left.parent=r):r.left=null,e.right=r,r.parent=e):(o?(r.right=o,o.parent=r):r.right=null,t.left=r,r.parent=t)),i?(e.left=i,i.parent=e):e.left=null,t.right=e,e.parent=t):(r&&(r.right===e?(e.left?(r.right=e.left,r.right.parent=r):r.right=null,e.left=r,r.parent=e):(i?(r.left=i,i.parent=r):r.left=null,t.right=r,r.parent=t)),o?(e.right=o,o.parent=e):e.right=null,t.left=e,e.parent=t)}replace(t,e){t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.parent=t.parent)}minNode(t=this._root){if(t)for(;t.left;)t=t.left;return t}maxNode(t=this._root){if(t)for(;t.right;)t=t.right;return t}insert(t,e){var r=this._root,n=null,o=this._compare;if(this._noDuplicates)for(;r;){if(n=r,0===o(r.key,t))return;r=o(r.key,t)<0?r.right:r.left}else for(;r;)n=r,r=o(r.key,t)<0?r.right:r.left;return r={key:t,data:e,left:null,right:null,parent:n},n?o(n.key,r.key)<0?n.right=r:n.left=r:this._root=r,this.splay(r),this._size++,r}find(t){for(var e=this._root,r=this._compare;e;){var n=r(e.key,t);if(n<0)e=e.right;else{if(!(n>0))return e;e=e.left}}return null}contains(t){for(var e=this._root,r=this._compare;e;){var n=r(t,e.key);if(0===n)return!0;e=n<0?e.left:e.right}return!1}remove(t){var e=this.find(t);if(!e)return!1;if(this.splay(e),e.left)if(e.right){var r=this.minNode(e.right);r.parent!==e&&(this.replace(r,r.right),r.right=e.right,r.right.parent=r),this.replace(e,r),r.left=e.left,r.left.parent=r}else this.replace(e,e.left);else this.replace(e,e.right);return this._size--,!0}removeNode(t){if(!t)return!1;if(this.splay(t),t.left)if(t.right){var e=this.minNode(t.right);e.parent!==t&&(this.replace(e,e.right),e.right=t.right,e.right.parent=e),this.replace(t,e),e.left=t.left,e.left.parent=e}else this.replace(t,t.left);else this.replace(t,t.right);return this._size--,!0}erase(t){var e=this.find(t);if(e){this.splay(e);var r=e.left,n=e.right,o=null;r&&(r.parent=null,o=this.maxNode(r),this.splay(o),this._root=o),n&&(r?o.right=n:this._root=n,n.parent=o),this._size--}}pop(){var t=this._root,e=null;if(t){for(;t.left;)t=t.left;e={key:t.key,data:t.data},this.remove(t.key)}return e}next(t){var e=t;if(e)if(e.right)for(e=e.right;e&&e.left;)e=e.left;else for(e=t.parent;e&&e.right===t;)t=e,e=e.parent;return e}prev(t){var e=t;if(e)if(e.left)for(e=e.left;e&&e.right;)e=e.right;else for(e=t.parent;e&&e.left===t;)t=e,e=e.parent;return e}forEach(t){for(var e=this._root,r=[],n=!1,o=0;!n;)e?(r.push(e),e=e.left):r.length>0?(t(e=r.pop(),o++),e=e.right):n=!0;return this}range(t,e,r,n){const o=[],i=this._compare;let a,s=this._root;for(;0!==o.length||s;)if(s)o.push(s),s=s.left;else{if(s=o.pop(),a=i(s.key,e),a>0)break;if(i(s.key,t)>=0&&r.call(n,s))return this;s=s.right}return this}keys(){for(var t=this._root,e=[],r=[],n=!1;!n;)t?(e.push(t),t=t.left):e.length>0?(t=e.pop(),r.push(t.key),t=t.right):n=!0;return r}values(){for(var t=this._root,e=[],r=[],n=!1;!n;)t?(e.push(t),t=t.left):e.length>0?(t=e.pop(),r.push(t.data),t=t.right):n=!0;return r}at(t){for(var e=this._root,r=[],n=!1,o=0;!n;)if(e)r.push(e),e=e.left;else if(r.length>0){if(e=r.pop(),o===t)return e;o++,e=e.right}else n=!0;return null}load(t=[],e=[],r=!1){if(0!==this._size)throw new Error("bulk-load: tree is not empty");const n=t.length;return r&&J(t,e,0,n-1,this._compare),this._root=D(null,t,e,0,n),this._size=n,this}min(){var t=this.minNode(this._root);return t?t.key:null}max(){var t=this.maxNode(this._root);return t?t.key:null}isEmpty(){return null===this._root}get size(){return this._size}static createTree(t,e,r,n,o){return new z(r,o).load(t,e,n)}}function D(t,e,r,n,o){const i=o-n;if(i>0){const a=n+Math.floor(i/2),s={key:e[a],data:r[a],parent:t};return s.left=D(s,e,r,n,a),s.right=D(s,e,r,a+1,o),s}return null}function J(t,e,r,n,o){if(r>=n)return;const i=t[r+n>>1];let a=r-1,s=n+1;for(;;){do{a++}while(o(t[a],i)<0);do{s--}while(o(t[s],i)>0);if(a>=s)break;let r=t[a];t[a]=t[s],t[s]=r,r=e[a],e[a]=e[s],e[s]=r}J(t,e,r,s,o),J(t,e,s+1,n,o)}function K(t,e,r){null===e?(t.inOut=!1,t.otherInOut=!0):(t.isSubject===e.isSubject?(t.inOut=!e.inOut,t.otherInOut=e.otherInOut):(t.inOut=!e.otherInOut,t.otherInOut=e.isVertical()?!e.inOut:e.inOut),e&&(t.prevInResult=!U(e,r)||e.isVertical()?e.prevInResult:e));let n=U(t,r);t.resultTransition=n?function(t,e){let r,n=!t.inOut,o=!t.otherInOut;switch(e){case 0:r=n&&o;break;case 1:r=n||o;break;case 3:r=n^o;break;case 2:r=t.isSubject?n&&!o:o&&!n}return r?1:-1}(t,r):0}function U(t,e){switch(t.type){case 0:switch(e){case 0:return!t.otherInOut;case 1:return t.otherInOut;case 2:return t.isSubject&&t.otherInOut||!t.isSubject&&!t.otherInOut;case 3:return!0}break;case 2:return 0===e||1===e;case 3:return 2===e;case 1:return!1}return!1}class V{constructor(t,e,r,n,o){this.left=e,this.point=t,this.otherEvent=r,this.isSubject=n,this.type=o||0,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0}isBelow(t){const e=this.point,r=this.otherEvent.point;return this.left?(e[0]-t[0])*(r[1]-t[1])-(r[0]-t[0])*(e[1]-t[1])>0:(r[0]-t[0])*(e[1]-t[1])-(e[0]-t[0])*(r[1]-t[1])>0}isAbove(t){return!this.isBelow(t)}isVertical(){return this.point[0]===this.otherEvent.point[0]}get inResult(){return 0!==this.resultTransition}clone(){const t=new V(this.point,this.left,this.otherEvent,this.isSubject,this.type);return t.contourId=this.contourId,t.resultTransition=this.resultTransition,t.prevInResult=this.prevInResult,t.isExteriorRing=this.isExteriorRing,t.inOut=this.inOut,t.otherInOut=this.otherInOut,t}}function W(t,e){return t[0]===e[0]&&t[1]===e[1]}const $=134217729;function H(t,e,r,n,o){let i,a,s,u,l=e[0],p=n[0],c=0,f=0;p>l==p>-l?(i=l,l=e[++c]):(i=p,p=n[++f]);let h=0;if(c<t&&f<r)for(p>l==p>-l?(a=l+i,s=i-(a-l),l=e[++c]):(a=p+i,s=i-(a-p),p=n[++f]),i=a,0!==s&&(o[h++]=s);c<t&&f<r;)p>l==p>-l?(a=i+l,u=a-i,s=i-(a-u)+(l-u),l=e[++c]):(a=i+p,u=a-i,s=i-(a-u)+(p-u),p=n[++f]),i=a,0!==s&&(o[h++]=s);for(;c<t;)a=i+l,u=a-i,s=i-(a-u)+(l-u),l=e[++c],i=a,0!==s&&(o[h++]=s);for(;f<r;)a=i+p,u=a-i,s=i-(a-u)+(p-u),p=n[++f],i=a,0!==s&&(o[h++]=s);return 0===i&&0!==h||(o[h++]=i),h}function Q(t){return new Float64Array(t)}const X=Q(4),Y=Q(8),Z=Q(12),tt=Q(16),et=Q(4);function rt(t,e,r,n,o,i){const a=(e-i)*(r-o),s=(t-o)*(n-i),u=a-s;if(0===a||0===s||a>0!=s>0)return u;const l=Math.abs(a+s);return Math.abs(u)>=33306690738754716e-32*l?u:-function(t,e,r,n,o,i,a){let s,u,l,p,c,f,h,g,y,d,m,v,b,w,P,k,E,S;const O=t-o,_=r-o,M=e-i,j=n-i;w=O*j,f=$*O,h=f-(f-O),g=O-h,f=$*j,y=f-(f-j),d=j-y,P=g*d-(w-h*y-g*y-h*d),k=M*_,f=$*M,h=f-(f-M),g=M-h,f=$*_,y=f-(f-_),d=_-y,E=g*d-(k-h*y-g*y-h*d),m=P-E,c=P-m,X[0]=P-(m+c)+(c-E),v=w+m,c=v-w,b=w-(v-c)+(m-c),m=b-k,c=b-m,X[1]=b-(m+c)+(c-k),S=v+m,c=S-v,X[2]=v-(S-c)+(m-c),X[3]=S;let x=function(t,e){let r=e[0];for(let n=1;n<t;n++)r+=e[n];return r}(4,X),I=22204460492503146e-32*a;if(x>=I||-x>=I)return x;if(c=t-O,s=t-(O+c)+(c-o),c=r-_,l=r-(_+c)+(c-o),c=e-M,u=e-(M+c)+(c-i),c=n-j,p=n-(j+c)+(c-i),0===s&&0===u&&0===l&&0===p)return x;if(I=11093356479670487e-47*a+33306690738754706e-32*Math.abs(x),x+=O*p+j*s-(M*l+_*u),x>=I||-x>=I)return x;w=s*j,f=$*s,h=f-(f-s),g=s-h,f=$*j,y=f-(f-j),d=j-y,P=g*d-(w-h*y-g*y-h*d),k=u*_,f=$*u,h=f-(f-u),g=u-h,f=$*_,y=f-(f-_),d=_-y,E=g*d-(k-h*y-g*y-h*d),m=P-E,c=P-m,et[0]=P-(m+c)+(c-E),v=w+m,c=v-w,b=w-(v-c)+(m-c),m=b-k,c=b-m,et[1]=b-(m+c)+(c-k),S=v+m,c=S-v,et[2]=v-(S-c)+(m-c),et[3]=S;const L=H(4,X,4,et,Y);w=O*p,f=$*O,h=f-(f-O),g=O-h,f=$*p,y=f-(f-p),d=p-y,P=g*d-(w-h*y-g*y-h*d),k=M*l,f=$*M,h=f-(f-M),g=M-h,f=$*l,y=f-(f-l),d=l-y,E=g*d-(k-h*y-g*y-h*d),m=P-E,c=P-m,et[0]=P-(m+c)+(c-E),v=w+m,c=v-w,b=w-(v-c)+(m-c),m=b-k,c=b-m,et[1]=b-(m+c)+(c-k),S=v+m,c=S-v,et[2]=v-(S-c)+(m-c),et[3]=S;const A=H(L,Y,4,et,Z);w=s*p,f=$*s,h=f-(f-s),g=s-h,f=$*p,y=f-(f-p),d=p-y,P=g*d-(w-h*y-g*y-h*d),k=u*l,f=$*u,h=f-(f-u),g=u-h,f=$*l,y=f-(f-l),d=l-y,E=g*d-(k-h*y-g*y-h*d),m=P-E,c=P-m,et[0]=P-(m+c)+(c-E),v=w+m,c=v-w,b=w-(v-c)+(m-c),m=b-k,c=b-m,et[1]=b-(m+c)+(c-k),S=v+m,c=S-v,et[2]=v-(S-c)+(m-c),et[3]=S;const T=H(A,Z,4,et,tt);return tt[T-1]}(t,e,r,n,o,i,l)}function nt(t,e,r){const n=rt(t[0],t[1],e[0],e[1],r[0],r[1]);return n>0?-1:n<0?1:0}function ot(t,e){const r=t.point,n=e.point;return r[0]>n[0]?1:r[0]<n[0]?-1:r[1]!==n[1]?r[1]>n[1]?1:-1:function(t,e,r,n){if(t.left!==e.left)return t.left?1:-1;if(0!==nt(r,t.otherEvent.point,e.otherEvent.point))return t.isBelow(e.otherEvent.point)?-1:1;return!t.isSubject&&e.isSubject?1:-1}(t,e,r)}function it(t,e,r){const n=new V(e,!1,t,t.isSubject),o=new V(e,!0,t.otherEvent,t.isSubject);return W(t.point,t.otherEvent.point)&&console.warn("what is that, a collapsed segment?",t),n.contourId=o.contourId=t.contourId,ot(o,t.otherEvent)>0&&(t.otherEvent.left=!0,o.left=!1),t.otherEvent.otherEvent=o,t.otherEvent=n,r.push(o),r.push(n),r}function at(t,e){return t[0]*e[1]-t[1]*e[0]}function st(t,e){return t[0]*e[0]+t[1]*e[1]}function ut(t,e,r){const n=function(t,e,r,n,o){const i=[e[0]-t[0],e[1]-t[1]],a=[n[0]-r[0],n[1]-r[1]];function s(t,e,r){return[t[0]+e*r[0],t[1]+e*r[1]]}const u=[r[0]-t[0],r[1]-t[1]];let l=at(i,a),p=l*l;const c=st(i,i);if(p>0){const e=at(u,a)/l;if(e<0||e>1)return null;const n=at(u,i)/l;return n<0||n>1?null:0===e||1===e?o?null:[s(t,e,i)]:0===n||1===n?o?null:[s(r,n,a)]:[s(t,e,i)]}if(l=at(u,i),p=l*l,p>0)return null;const f=st(i,u)/c,h=f+st(i,a)/c,g=Math.min(f,h),y=Math.max(f,h);return g<=1&&y>=0?1===g?o?null:[s(t,g>0?g:0,i)]:0===y?o?null:[s(t,y<1?y:1,i)]:o&&0===g&&1===y?null:[s(t,g>0?g:0,i),s(t,y<1?y:1,i)]:null}(t.point,t.otherEvent.point,e.point,e.otherEvent.point),o=n?n.length:0;if(0===o)return 0;if(1===o&&(W(t.point,e.point)||W(t.otherEvent.point,e.otherEvent.point)))return 0;if(2===o&&t.isSubject===e.isSubject)return 0;if(1===o)return W(t.point,n[0])||W(t.otherEvent.point,n[0])||it(t,n[0],r),W(e.point,n[0])||W(e.otherEvent.point,n[0])||it(e,n[0],r),1;const i=[];let a=!1,s=!1;return W(t.point,e.point)?a=!0:1===ot(t,e)?i.push(e,t):i.push(t,e),W(t.otherEvent.point,e.otherEvent.point)?s=!0:1===ot(t.otherEvent,e.otherEvent)?i.push(e.otherEvent,t.otherEvent):i.push(t.otherEvent,e.otherEvent),a&&s||a?(e.type=1,t.type=e.inOut===t.inOut?2:3,a&&!s&&it(i[1].otherEvent,i[0].point,r),2):s?(it(i[0],i[1].point,r),3):i[0]!==i[3].otherEvent?(it(i[0],i[1].point,r),it(i[1],i[2].point,r),3):(it(i[0],i[1].point,r),it(i[3].otherEvent,i[2].point,r),3)}function lt(t,e){if(t===e)return 0;if(0!==nt(t.point,t.otherEvent.point,e.point)||0!==nt(t.point,t.otherEvent.point,e.otherEvent.point))return W(t.point,e.point)?t.isBelow(e.otherEvent.point)?-1:1:t.point[0]===e.point[0]?t.point[1]<e.point[1]?-1:1:1===ot(t,e)?e.isAbove(t.point)?-1:1:t.isBelow(e.point)?-1:1;if(t.isSubject!==e.isSubject)return t.isSubject?-1:1;{let r=t.point,n=e.point;if(r[0]===n[0]&&r[1]===n[1])return r=t.otherEvent.point,n=e.otherEvent.point,r[0]===n[0]&&r[1]===n[1]?0:t.contourId>e.contourId?1:-1}return 1===ot(t,e)?1:-1}class pt{constructor(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null}isExterior(){return null==this.holeOf}}function ct(t,e,r,n){let o,i=t+1,a=e[t].point;const s=e.length;for(i<s&&(o=e[i].point);i<s&&o[0]===a[0]&&o[1]===a[1];){if(!r[i])return i;i++,i<s&&(o=e[i].point)}for(i=t-1;r[i]&&i>n;)i--;return i}function ft(t,e,r){const n=new pt;if(null!=t.prevInResult){const o=t.prevInResult,i=o.outputContourId;if(o.resultTransition>0){const t=e[i];if(null!=t.holeOf){const o=t.holeOf;e[o].holeIds.push(r),n.holeOf=o,n.depth=e[i].depth}else e[i].holeIds.push(r),n.holeOf=i,n.depth=e[i].depth+1}else n.holeOf=null,n.depth=e[i].depth}else n.holeOf=null,n.depth=0;return n}function ht(t){let e,r;const n=function(t){let e,r,n,o;const i=[];for(r=0,n=t.length;r<n;r++)e=t[r],(e.left&&e.inResult||!e.left&&e.otherEvent.inResult)&&i.push(e);let a=!1;for(;!a;)for(a=!0,r=0,n=i.length;r<n;r++)r+1<n&&1===ot(i[r],i[r+1])&&(o=i[r],i[r]=i[r+1],i[r+1]=o,a=!1);for(r=0,n=i.length;r<n;r++)e=i[r],e.otherPos=r;for(r=0,n=i.length;r<n;r++)e=i[r],e.left||(o=e.otherPos,e.otherPos=e.otherEvent.otherPos,e.otherEvent.otherPos=o);return i}(t),o={},i=[];for(e=0,r=n.length;e<r;e++){if(o[e])continue;const t=i.length,r=ft(n[e],i,t),a=e=>{o[e]=!0,e<n.length&&n[e]&&(n[e].outputContourId=t)};let s=e,u=e;const l=n[e].point;for(r.points.push(l);a(s),s=n[s].otherPos,a(s),r.points.push(n[s].point),s=ct(s,n,o,u),!(s==u||s>=n.length)&&n[s];);i.push(r)}return i}var gt=dt,yt=dt;function dt(t,e){if(!(this instanceof dt))return new dt(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||mt,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)}function mt(t,e){return t<e?-1:t>e?1:0}dt.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,r=this.compare,n=e[t];t>0;){var o=t-1>>1,i=e[o];if(r(n,i)>=0)break;e[t]=i,t=o}e[t]=n},_down:function(t){for(var e=this.data,r=this.compare,n=this.length>>1,o=e[t];t<n;){var i=1+(t<<1),a=i+1,s=e[i];if(a<this.length&&r(e[a],s)<0&&(i=a,s=e[a]),r(s,o)>=0)break;e[t]=s,t=i}e[t]=o}},gt.default=yt;const vt=Math.max,bt=Math.min;let wt=0;function Pt(t,e,r,n,o,i){let a,s,u,l,p,c;for(a=0,s=t.length-1;a<s;a++){if(u=t[a],l=t[a+1],p=new V(u,!1,void 0,e),c=new V(l,!1,p,e),p.otherEvent=c,u[0]===l[0]&&u[1]===l[1])continue;p.contourId=c.contourId=r,i||(p.isExteriorRing=!1,c.isExteriorRing=!1),ot(p,c)>0?c.left=!0:p.left=!0;const s=u[0],f=u[1];o[0]=bt(o[0],s),o[1]=bt(o[1],f),o[2]=vt(o[2],s),o[3]=vt(o[3],f),n.push(p),n.push(c)}}const kt=[];function Et(t,e,r){"number"==typeof t[0][0][0]&&(t=[t]),"number"==typeof e[0][0][0]&&(e=[e]);let n=function(t,e,r){let n=null;return t.length*e.length==0&&(0===r?n=kt:2===r?n=t:1!==r&&3!==r||(n=0===t.length?e:t)),n}(t,e,r);if(n)return n===kt?null:n;const o=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],a=function(t,e,r,n,o){const i=new gt(null,ot);let a,s,u,l,p,c;for(u=0,l=t.length;u<l;u++)for(a=t[u],p=0,c=a.length;p<c;p++)s=0===p,s&&wt++,Pt(a[p],!0,wt,i,r,s);for(u=0,l=e.length;u<l;u++)for(a=e[u],p=0,c=a.length;p<c;p++)s=0===p,2===o&&(s=!1),s&&wt++,Pt(a[p],!1,wt,i,n,s);return i}(t,e,o,i,r);if(n=function(t,e,r,n,o){let i=null;return(r[0]>n[2]||n[0]>r[2]||r[1]>n[3]||n[1]>r[3])&&(0===o?i=kt:2===o?i=t:1!==o&&3!==o||(i=t.concat(e))),i}(t,e,o,i,r),n)return n===kt?null:n;const s=ht(function(t,e,r,n,o,i){const a=new z(lt),s=[],u=Math.min(n[2],o[2]);let l,p,c;for(;0!==t.length;){let e=t.pop();if(s.push(e),0===i&&e.point[0]>u||2===i&&e.point[0]>n[2])break;if(e.left){p=l=a.insert(e),c=a.minNode(),l=l!==c?a.prev(l):null,p=a.next(p);const r=l?l.key:null;let n;if(K(e,r,i),p&&2===ut(e,p.key,t)&&(K(e,r,i),K(p.key,e,i)),l&&2===ut(l.key,e,t)){let t=l;t=t!==c?a.prev(t):null,n=t?t.key:null,K(r,n,i),K(e,r,i)}}else e=e.otherEvent,p=l=a.find(e),l&&p&&(l=l!==c?a.prev(l):null,p=a.next(p),a.remove(e),p&&l&&ut(l.key,p.key,t))}return s}(a,0,0,o,i,r)),u=[];for(let t=0;t<s.length;t++){let e=s[t];if(e.isExterior()){let t=[e.points];for(let r=0;r<e.holeIds.length;r++){let n=e.holeIds[r];t.push(s[n].points)}u.push(t)}}return u}var St=function(t,e){for(var r=t[0],n=t[1],o=!1,i=0,a=e.length-1;i<e.length;a=i++){var s=e[i][0],u=e[i][1],l=e[a][0],p=e[a][1];u>n!=p>n&&r<(l-s)*(n-u)/(p-u)+s&&(o=!o)}return o},Ot=function(t){if("Point"!==t.geometry.type){switch(t.properties.way_geometry=r({},t.geometry),t.geometry.type){case"Polygon":t.properties.mesure=C(t.geometry);break;case"LineString":t.properties.mesure=G(t)}t.geometry=L(t.geometry).geometry}},_t=function(t){if("no"===t.area)return!1;var e=Object.keys(t);return!(!e.includes("building")||"no"===t.building)||(!(!e.includes("landuse")||"no"===t.landuse)||(!(!e.includes("amenity")||"no"===t.amenity)||(!(!e.includes("leisure")||"no"===t.leisure)||(!(!e.includes("area")||"no"===t.area)||(!(!e.includes("place")||"no"===t.place)||(!(!e.includes("shop")||"no"===t.shop)||(!(!e.includes("boundary")||"no"===t.boundary)||(!(!e.includes("tourism")||"no"===t.tourism)||(!(!e.includes("historic")||"no"===t.historic)||(!(!e.includes("public_transport")||"no"===t.public_transport)||(!(!e.includes("office")||"no"===t.office)||(!(!e.includes("building:part")||"no"===t["building:part"])||(!(!e.includes("military")||"no"===t.military)||(!(!e.includes("ruins")||"no"===t.ruins)||(!(!e.includes("craft")||"no"===t.craft)||(!(!e.includes("golf")||"no"===t.golf)||(!(!e.includes("indoor")||"no"===t.indoor)||(!(!e.includes("highway")||!["services","rest_area","escape","elevator"].includes(t.highway))||(!(!e.includes("waterway")||!["riverbank","dock","boatyard","dam"].includes(t.waterway))||(!(!e.includes("barrier")||!["city_wall","ditch","hedge","retaining_wall","wall","spikes"].includes(t.barrier))||(!(!e.includes("railway")||!["station","turntable","roundhouse","platform"].includes(t.railway))||(!(!e.includes("power")||!["plant","substation","generator","transformer"].includes(t.power))||(!(!e.includes("natural")||["coastline","cliff","ridge","arete","tree_row"].includes(t.natural))||(!(!e.includes("man_made")||["cutline","embankment","pipeline"].includes(t.man_made))||!(!e.includes("aeroway")||["taxiway"].includes(t.aeroway))))))))))))))))))))))))))},Mt=function(t,e){if(!e)return!0;if(!t)return!1;for(var r=0,n=Object.keys(t);r<n.length;r++){var o=n[r];if(e.includes(o))return!0}return!1},jt=function(t,e){var r=t.properties.tags;for(var n in r)if(e.includes(n))return{k:n,v:r[n]};return null};function xt(t,e){var r,n=t.properties.tags,o={conf:void 0,matchProps:0},i=s(e);try{for(i.s();!(r=i.n()).done;){var a=r.value,u=Object.keys(a.tags)[0],l=0;for(var p in a.tags)n[p]&&n[p]===a.tags[p]&&n[u]?l++:l=0;l>o.matchProps&&(o={conf:a,matchProps:l})}}catch(t){i.e(t)}finally{i.f()}if(o.conf)return o.conf;var c=t.properties.primaryTag.k?"k":"key",f=t.properties.primaryTag.k?"v":"value",h="".concat(t.properties.primaryTag[c],"/").concat(t.properties.primaryTag[f]),g={key:t.properties.primaryTag[c],icon:"wiki-question",markerColor:"#000000",lbl:{en:"".concat(t.properties.primaryTag[c]," = ").concat(t.properties.primaryTag[f])},presets:[],geometry:[],tags:{},id:h,unknowTags:!0};return g.tags[t.properties.primaryTag[c]]=t.properties.primaryTag[f],g}function It(t){t.properties.tags.name?t.properties._name=t.properties.tags.name:t.properties.tags.ref&&(t.properties._name=t.properties.tags.ref),t.properties.meta.timestamp&&(t.properties.time=new Date(t.properties.meta.timestamp).getTime()),t.properties.tags.fixme&&(t.properties.fixme=!0)}function Lt(t,e){var r,n=xt(t,e);return r="node"===t.properties.type?"circle":"LineString"===t.properties.way_geometry.type||"MultiLineString"===t.properties.way_geometry.type?"penta":"Polygon"===t.properties.way_geometry.type||"MultiPolygon"===t.properties.way_geometry.type?"square":"star",t.properties.icon=n.icon?n.icon:"",t.properties.marker="".concat(r,"-").concat(n.markerColor,"-").concat(t.properties.icon),t.properties.hexColor=n.markerColor,t.properties.configId=n.id,n.unknowTags&&(t.properties.unknowTags=!0),n.deprecated?t.properties.deprecated=n.deprecated:t.properties.deprecated&&delete t.properties.deprecated,It(t),t}var At=function(t,e){if(!e)return t;for(var n=[],o=0;o<e.features.length;o++)n.push(e.features[o].id);for(var i=t.features.length-1;i>=0;i--)n.includes(t.features[i].id)&&t.features.splice(i,1);return r({},t)},Tt=function(t,e){var r,n;return e&&0!==e.length?{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"MultiPolygon",coordinates:(r=e.geometry.coordinates,n=t.geometry.coordinates,Et(r,n,1))}}]}:{type:"FeatureCollection",features:[t]}};return t.addAttributesToFeature=It,t.convert=function(t,e){var n=null;e&&e.primaryKeys&&(n=e.primaryKeys);var i,a="string"==typeof t?JSON.parse(t):t,u={minlat:Number(a.bounds.minlat),minlon:Number(a.bounds.minlon),maxlat:Number(a.bounds.maxlat),maxlon:Number(a.bounds.maxlon)},l=[u.minlon,u.minlat,u.maxlon,u.maxlat],p=function(t,e){for(var r=t[0]==t[t.length-1]?"Polygon":"LineString",n=[],o=0;o<t.length;o++){var i="node/".concat(t[o]);e[i]&&n.push(e[i].geometry.coordinates)}return"LineString"==r?{type:"LineString",coordinates:n}:"Polygon"==r?{type:"Polygon",coordinates:[n]}:void 0},c=function(t,e){var n=r({},t),i=Array.isArray(n.member)?n.member:[n.member];n.tainted=!1;for(var a=0;a<i.length;a++){var u=i[a],l="".concat(u.type,"/").concat(u.ref);if(e[l]){var p=e[l].geometry,c=void 0;"LineString"===p.type?(u.typeGeom="LineString",c=o(p.coordinates)):"Polygon"===p.type&&(u.typeGeom="Polygon",c=o(p.coordinates[0])),u.ring=c}else u.ring=null,n.tainted=!0}if(n.tainted)return null;Array.isArray(i)||(i=[i]);var h=i.filter((function(t){return"outer"===t.role&&"Polygon"===t.typeGeom&&t.ring})),g=i.filter((function(t){return"inner"===t.role&&"Polygon"===t.typeGeom&&t.ring})),y=i.filter((function(t){return"outer"===t.role&&"LineString"===t.typeGeom&&t.ring})),d=i.filter((function(t){return"inner"===t.role&&"LineString"===t.typeGeom&&t.ring}));if(0===h.length&&0===y.length)return null;if(y.length>0){var m,v=s(f(y.map((function(t){return t.ring}))));try{for(v.s();!(m=v.n()).done;){var b=m.value;h.push({type:"way",ref:"",role:"outer",typeGeom:"Polygon",ring:b})}}catch(t){v.e(t)}finally{v.f()}}if(d.length>0){var w,P=s(f(d.map((function(t){return t.ring}))));try{for(P.s();!(w=P.n()).done;){var k=w.value;g.push({type:"way",ref:"",role:"inner",typeGeom:"Polygon",ring:k})}}catch(t){P.e(t)}finally{P.f()}}if(1==h.length){var E,S=[h[0].ring],O=s(g);try{for(O.s();!(E=O.n()).done;){var _=E.value;S.push(_.ring)}}catch(t){O.e(t)}finally{O.f()}return{type:"Polygon",coordinates:S}}var M,j=h.map((function(t){return[t.ring]})),x=s(g);try{for(x.s();!(M=x.n()).done;)for(var I=M.value,L=0;L<j.length;L++){var A=j[L][0],T=I.ring[0];St(T,A)&&j[L].push(I.ring)}}catch(t){x.e(t)}finally{x.f()}return{type:"MultiPolygon",coordinates:j}},f=function(t){var e=[],r=t[0].slice();t.splice(0,1);for(var n=r[0].toString(),i=r[r.length-1].toString(),a=0;0!=t.length&&a<t.length;)t[a][0].toString()==i?(t[a].splice(0,1),r=[].concat(o(r),o(t[a])),t.splice(a,1),n=r[0].toString(),i=r[r.length-1].toString(),a=0):t[a][t[a].length-1].toString()==n?(t[a].splice(t[a].length-1,1),r=[].concat(o(t[a]),o(r)),t.splice(a,1),n=r[0].toString(),i=r[r.length-1].toString(),a=0):t[a][0].toString()==n?(t[a].splice(0,1),r=[].concat(o(t[a].reverse()),o(r)),t.splice(a,1),n=r[0].toString(),i=r[r.length-1].toString(),a=0):t[a][t[a].length-1].toString()==i?(t[a].splice(t[a].length-1,1),r=[].concat(o(r),o(t[a].reverse())),t.splice(a,1),n=r[0].toString(),i=r[r.length-1].toString(),a=0):a++,n==i&&(e.push(r),t.length>0&&(r=t[0].slice(),t.splice(0,1),n=r[0].toString(),i=r[r.length-1].toString(),a=0));return e},h=[],g=[],y=s(a.elements);try{for(y.s();!(i=y.n()).done;){var d=i.value;if("node"===d.type){var m=d,v={type:"Feature",id:"node/".concat(d.id),properties:{type:"node",id:d.id,meta:{timestamp:d.timestamp,version:d.version,changeset:d.changeset,user:d.user,uid:d.uid}},geometry:{type:"Point",coordinates:[d.lon,d.lat]}};d.tags&&(v.properties.tags=d.tags),g["node/".concat(m.id)]=v}else if("way"===d.type){var b=d,w={type:"Feature",id:"way/".concat(d.id),properties:{type:"way",id:d.id,meta:{timestamp:d.timestamp,version:d.version,changeset:b.changeset,user:d.user,uid:d.uid}}};if(d.tags&&(w.properties.tags=d.tags),d.nodes){var P,k=[],E=s(d.nodes);try{for(E.s();!(P=E.n()).done;){var S=P.value;k.push(S);var O=g["node/".concat(S)];O&&(O.properties.usedByWays||(O.properties.usedByWays=[]),O.properties.usedByWays.push("way/".concat(d.id)))}}catch(t){E.e(t)}finally{E.f()}w.ndRefs=k,w.geometry=p(k,g)}g["way/".concat(d.id)]=w}else if("relation"===d.type){var _={type:"Feature",id:"rel/".concat(d.id),properties:{type:"relation",id:d.id,meta:{timestamp:d.timestamp,version:d.version,changeset:d.changeset,user:d.user,uid:d.uid}},member:d.members,tainted:!1};d.tags&&(_.properties.tags=d.tags),Array.isArray(d.members)||(d.members=[d.members]);var M,j=s(d.members);try{for(j.s();!(M=j.n()).done;){var I=M.value,L="".concat(I.type,"/").concat(I.ref);g[L]?(g[L].properties.relations||(g[L].properties.relations=[]),g[L].properties.relations.push({rel:_.id,reltags:_.properties.tags,role:I.role})):_.tainted=!0}}catch(t){j.e(t)}finally{j.f()}"multipolygon"===_.properties.tags.type&&h.push("rel/".concat(_.id)),g["rel/".concat(_.id)]=_}}}catch(t){y.e(t)}finally{y.f()}for(var A=0,T=h;A<T.length;A++){var C=T[A],F=c(g[C],g);F&&(g[C].geometry=F)}var N={type:"FeatureCollection",features:function(t,e,r){var o=[];for(var i in t){var a=t[i];if("node"==a.properties.type){if(a.geometry&&a.properties.tags)if(e){var s=jt(a,r);s&&(a.properties.primaryTag=s,Lt(a,e),o.push(a))}else It(a),o.push(a)}else if("way"==a.properties.type){if(a.geometry&&a.properties.tags)if("Polygon"!=a.geometry.type&&"MultiPolygon"!=a.geometry.type||_t(a.properties.tags)||(a.geometry.coordinates=a.geometry.coordinates[0],a.geometry.type="Polygon"==a.geometry.type?"LineString":"MultiLineString"),Ot(a),e){var u=jt(a,r);u&&(a.properties.primaryTag=u,Lt(a,e),o.push(a))}else It(a),o.push(a)}else if("relation"==a.properties.type&&a.geometry&&a.properties.tags&&Mt(a.properties.tags,n))if("Polygon"!=a.geometry.type&&"MultiPolygon"!=a.geometry.type||_t(a.properties.tags)||(a.geometry.coordinates=a.geometry.coordinates[0],a.geometry.type="Polygon"==a.geometry.type?"LineString":"MultiLineString"),Ot(a),e){var l=jt(a,r);l&&(a.properties.primaryTag=l,Lt(a,e),o.push(a))}else It(a),o.push(a)}return o}(g,e.tagConfig,e.primaryKeys)};if(e&&e.oldGeojson&&e.geojsonChanged){var R=Number.isInteger(e.limitFeatures)?e.limitFeatures:9999,G=B(l);return e.oldGeojson.features.length>R?{geojson:At(N,e.geojsonChanged),geojsonBbox:Tt(G,null)}:{geojson:function(t,e,r,n){var o=t.features,i=e.features;if(!o||0==o.length)return e;for(var a=[],s=0;s<o.length;s++)x(o[s],r)&&a.push(o[s].id);for(var u=0;u<i.length;u++)for(var l=i[u].id,p=0;p<o.length;p++){if(l==o[p].id){o[p]=i[u],a.splice(a.indexOf(l),1);break}p==o.length-1&&o.push(i[u])}for(var c=0;c<a.length;c++)for(var f=a[c],h=0;h<o.length;h++)if(o[h].id==f){o.splice(h,1);break}return At(t,n)}(e.oldGeojson,N,G,e.geojsonChanged),geojsonBbox:Tt(G,e.oldBboxFeature)}}return{geojson:N,geojsonBbox:null}},t.getConfigTag=xt,t.setIconStyle=Lt,Object.defineProperty(t,"__esModule",{value:!0}),t}({});
